性能监控
=========================

可以在 OCP 上查看集群的历史性能监控信息。

所有集群的性能监控
------------------------------

1. 登录 OCP 。

2. 在左侧导航栏单击 **集群** ，进入 **集群概览** 页面。

   在 OCP 的 **集群** 页面展示了当前所有集群的性能指标 Top5 信息。您可以查看某个时间段某个性能指标的和从大到小排序最大的 5 个集群。

   可以根据业务需要，选择待查看的性能指标和对应的时间范围。单击右上角图标，可对图标进行放大查看。![1](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/2965260261/p264657.png)可选择的性能指标包括： **QPS** 、 **查询响应时间** 、 **活跃会话数** 和 **CPU 使用率** 。

   |     指标      |                  含义                  |
   |-------------|--------------------------------------|
   | QPS（time/s） | Query Per Second，当前 OCP 管理的集群的每秒查询率。 |
   | 查询响应时间（us）  | 显示集群的平均查询响应时间。                       |
   | 活跃会话数       | 显示单位时间内的活跃会话总数。                      |
   | CPU 使用率（%）  | 显示集群内 CPU 使用率的平均值。                   |

   可选择的时间范围包括： **最近一小时** 、 **最近一天** 和 **最近一周** 。

所有租户的性能监控
------------------------------

1. 登录 OCP 。

2. 在左侧导航栏上，单击 **租户** ，进入 **租户** 页面。

   在 **租户** 页面的 **租户监控 TOP5** 区域，可以查看当前所有集群中工作负载最高的 5 个租户的性能信息，包含 TPS、QPS、SQL 响应时间、事务响应时间、活跃会话数、事件等待_次数、事件等待_时间、容量_表数量、容量_分区数量等性能监控指标。

   可以查看最近一小时、最近一天或最近一周的监控信息。可单击右上角图标放大图标，也自定义设置监控时间。

   ![1](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/1912730261/p265457.png)性能监控指标相关说明如下表所示：

   |   指标名    |            说明            |            数据来源             |
   |----------|--------------------------|-----------------------------|
   | QPS      | 平均每秒处理的 SQL 语句的次数 (次/s)  | `v$sysstat`                 |
   | TPS      | 平均每秒处理事务的次数 (次/s)        | `v$sysstat`                 |
   | SQL 响应时间 | 服务端每条 SQL 语句的平均处理耗时 (us) | `v$sysstat`                 |
   | 事务响应时间   | 服务端每个事务平均处理耗时 (us)       | `v$sysstat`                 |
   | 活跃会话数    | 当前活跃会话数 (个)              | `__all_virtual_processlist` |
   | 事件等待_次数  | 每秒等待事件的次数 (次/s)          | `v$system_event`            |
   | 事件等待_时间  | 每个等待事件的平均耗时 (us)         | `v$system_event`            |
   | 容量_表数量   | 表数量（个）                   | `gv$table`                  |
   | 容量_分区数量  | 分区数量（个）                  | `v$partition`               |

指定集群的性能监控
------------------------------

1. 登录 OCP。

2. 在 **集群** 页面的 **集群列表** 区域，选择待操作的集群并单击其集群名。

3. 在显示的页面的左侧导航栏上，单击 **性能监控** 。

4. 在 **数据筛选** 区域，根据多种维度对租户的性能信息进行筛选。

   * **选择时间** ：选择某一段时间范围，用于返回这段时间范围内的数据。

   * **统计周期** ：

     * 主要用于计算每个点数据的统计周期，支持按 **每分钟** 和 **每秒** 统计，分别对应了每分钟一个点或每秒钟一个点，OCP 同时也会根据选择的时间区间再去计算一个统计周期。

     * 计算的规则是使返回的数据接近 1440 个点，如果选择的时间区间比较长，可能会出现统计周期大于 1 分钟的情况。

   * **Zone** ：查看指定 Zone 的性能监控数据。

   * **OBServer** ：查看指定 OBServer 的性能监控数据。

     ![指定集群的性能监控](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/8355280061/p167601.png)

     如果需要查看实时数据，您也可以直接单击右上角的 **实时** 开关按钮，选择刷新频率、Zone 和 OBServer 后，系统会根据选择的刷新频率定时刷新数据。默认显示最近两分钟的秒级数据，支持的刷新频率为 10 秒和 1 秒。

5. 切换页签，分别查看集群的数据库性能和主机性能数据。

   如果需要展示其他指标，您可以单击区域右侧的 **指标选择** 按钮，在指标选择页面选择需要展示的指标，系统最多支持展示 10 个指标。

   数据库性能和主机性能中具体指标的含义请参考 OCP 对应版本的《用户指南》文档中 **监控指标** 章节的内容。

指定集群下租户的性能监控
---------------------------------

可以在 OCP 上查看某个集群下工作负载最高的 5 个租户的性能信息。

1. 登录 OCP。

2. 在 **集群** 页面的 **集群列表** 区域，选择待操作的集群并单击其集群名。

3. 在显示的页面的左侧导航栏上，单击 **租户管理** 。

4. 在 **租户管理** 的 **租户监控 TOP5** 区域，可以查看当前集群下工作负载最高的 5 个租户的性能信息，包含 TPS、QPS、SQL 响应时间、事务响应时间、活跃会话数、事件等待_次数、事件等待_时间、容量_表数量、容量_分区数量等性能监控指标。

   可以查看最近一小时、最近一天或最近一周的监控信息。

   ![指定集群的所有租户性能监控](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/8355280061/p167602.png)

指定租户的性能监控
------------------------------

1. 登录 OCP 。

2. 在左侧导航栏上，单击 **租户** 。

3. 在 **租户列表** 中，单击待查看的租户的租户名，进入租户 **总览** 页面。

4. 在左侧导航栏上，单击 **性能监控** 。

5. 根据多种维度对租户的性能信息进行筛选。

   * **选择时间** ：

     选择某一段时间范围，返回这段时间范围内的数据。

   * **统计周期** ：

     * 计算每个点数据的统计周期，支持 **每分钟** 和 **每秒** ，分别对应了每分钟一个点，每秒钟一个点。OCP 同时也会根据选择的时间区间再去计算一个统计周期。

     * 计算的规则是使返回的数据接近 1440 个点，如果选择的时间区间比较长，可能会出现统计周期大于 1 分钟的情况。

   * **Zone** ：查看指定 Zone 的性能监控数据。

   * **OBServer** ：查看指定 OBServer 的性能监控数据。

     ![执行租户的性能监控](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/8355280061/p167621.png)

     OCP 租户性能监控支持查看实时数据，在页面右上角打开 **实时** 开关，可以查看实时数据。数据会根据选择的刷新频率定时刷新，默认展示最近两分钟的秒级数据，支持的刷新频率为 10 秒和 1 秒。

     ![数据筛选](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/8355280061/p167622.png)

6. 在 **性能与 SQL** 页签查看租户的以下性能监控数据：

   * QPS：平均每秒处理 SQL 语句的次数

   * 响应时间：响应时间（us）

   * 活跃会话数：活跃的会话数量（个）

   * SQL 执行计划类别：SQL 执行计划的类别

   * 等待事件：每秒等待事件次数 （次/s）

   * 等待事件耗时：等待事件平均耗时（us）

   * 请求等待队列：每秒 SQL 进入等待队列个数（次/s）

   * 请求等待队列耗时：SQL 请求在等待队列中的等待耗时（us）

   * CPU 使用率：CPU使用率 (%)

   * MEMStore 使用率：MEMStore 使用率 (%)

   * Rpc 包耗时：Rpc 收、发包耗时

   * Rpc 包吞吐量：单位时间内 Rpc 收、发包 byte 数据量

7. 在 **事务** 页签查看租户的以下性能监控数据：

   * TPS：平均每秒处理事务数（次/s）

   * 事务响应时间：服务端每个事务平均处理时间（us）

   * 事务日志数：每秒提交的事务日志数（次/s）

   * 事务日志量：每秒提交的事务日志大小 （byte）

   * 事务日志耗时：服务端处理事务日志的平均耗时（us）

   * 锁等待：每秒事务锁等待次数

   * 等锁耗时：每个锁等待平均耗时（us）

8. 在 **存储与缓存** 页签，查看租户的以下性能监控数据：

   * MEMStore：OceanBase 数据库可写入数据内存（Mb）

   * IOPS：平均每秒 IO 次数（次/s）

   * IO 耗时：平均每次 IO 耗时（us）

   * IO 吞吐率：平均每秒 IO 数据量（byte）

   * 缓存大小：缓存大小（MB）

   * 缓存命中率：缓存命中率（%）
