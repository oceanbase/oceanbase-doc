# 在 Kubernetes 环境中部署 OceanBase 数据库

本文以一个简单的示例介绍如何通过 ob-operator 在 Kubernetes 环境中部署 OceanBase 数据库，帮助您快速上手。

## 前提条件

在开始之前，请确保您已满足以下条件：

- 您有可用的 Kubernetes 集群且至少有 2 个 CPU，10GB 内存和 100GB 存储空间。

- 您已安装 cert-manager。cert-manager 的安装方法请参考对应的[安装文档](https://cert-manager.io/docs/installation/)。

- 您已安装 local-path-provisioner 并确认其配置的目标地点有足够的存储空间。local-path-provisioner 的安装方法请参考对应的[安装文档](https://github.com/rancher/local-path-provisioner)。

## 部署 ob-operator

使用以下命令在 Kubernetes 集群中部署 ob-operator：

- 稳定版本

  ```shell
  kubectl apply -f https://raw.githubusercontent.com/oceanbase/ob-operator/2.1.0_release/deploy/operator.yaml
  ```

- 开发版本

  ```shell
  kubectl apply -f https://raw.githubusercontent.com/oceanbase/ob-operator/master/deploy/operator.yaml
  ```

使用以下命令验证 ob-operator 是否成功部署：

```shell
kubectl get pod -n oceanbase-system
```

预期输出：

```shell
NAME                                            READY   STATUS    RESTARTS   AGE
oceanbase-controller-manager-86cfc8f7bf-4hfnj   2/2     Running   0          1m
```

## 部署 OceanBase 集群

按照以下步骤在 Kubernetes 集群上部署和连接 OceanBase 集群：

1. 创建 Secrets

   在创建 OceanBase 集群之前，您必须创建特定用户所需的 secrets。使用以下命令创建 secrets：

    ```shell
    kubectl create secret generic root-password --from-literal=password='root_password'
    kubectl create secret generic proxyro-password --from-literal=password='proxyro_password'
    kubectl create secret generic monitor-password --from-literal=password='monitor_password'
    kubectl create secret generic operator-password --from-literal=password='operator_password'
    ```

2. 部署 OceanBase 集群

   使用以下命令在 Kubernetes 集群上部署 OceanBase 集群：

    ```shell
    kubectl apply -f https://raw.githubusercontent.com/oceanbase/ob-operator/2.1.0_release/example/quickstart/obcluster.yaml
    ```

    集群创建通常需要约 2 分钟。执行以下命令检查集群状态：

    ```shell
    kubectl get obclusters.oceanbase.oceanbase.com test
    ```

    预期输出：

    ```shell
    NAME   STATUS    AGE
    test   running   6m2s
    ```

3. 连接 OceanBase 集群

   按照以下步骤连接新创建的 OceanBase 集群：
  
    ```shell
    # 使用以下命令查找 observer 的 POD IP 和 POD 名称
    # POD 名的规则为 {cluster_name}-{cluster_id}-{zone}-uuid
    kubectl get pods -o wide
    # 使用以下命令连接集群
    mysql -h{POD_IP} -P2881 -uroot -p'root_password' oceanbase -A -c
    ```

## 相关文档

如果您希望进一步了解在 Kubernetes 环境当中使用 ob-operator 部署和管理 OceanBase 数据库的方法细节，可参考以下文档或者代码仓库。

- [用户手册](https://www.oceanbase.com/docs/community-ob-operator-doc-1000000000408367)

- [Github 文档](https://oceanbase.github.io/ob-operator/)

- [Github 代码仓库](https://github.com/oceanbase/ob-operator)
