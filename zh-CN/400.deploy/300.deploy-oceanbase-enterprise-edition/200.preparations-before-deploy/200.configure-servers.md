|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type||

# 服务器配置

本节主要介绍服务器的硬件设置要求，包括操作系统、BIOS 设置、磁盘挂载、网卡设置、软件要求等。

## 准备操作系统

### OAT/OCP 操作系统

支持在下表所示的操作系统中部署 OAT/OCP。

| 操作系统 | 支持版本 | 服务器类型 |
|-------------|------------|-----------|
| RHEL       | 7.2 及以上版本 | x86_64      |
| CentOS     | 7.2 及以上版本 | x86_64      |
| AnolisOS   | 8.6 及以上版本 | x86_64      |
| Alibaba Cloud Linux      | 2,3 | x86_64      |
| openSUSE   | 12SP3 及以上 | x86_64      |
| AnolisOS   | 8.6 及以上版本 | ARM aarch64 |
| Alibaba Cloud Linux      | 2,3 | ARM aarch64 |
| 中标麒麟       | 7.6       | ARM aarch64 |
| 华为 EulerOS | 2.0 SP8   | ARM aarch64 |

### OceanBase 数据库操作系统

支持在下表所示的 Linux 操作系统中安装 OceanBase 数据库。

|       Linux 操作系统      |    版本   |             服务器架构         |
|-------------------------|-----------|-------------------------------|
| Alibaba Cloud Linux     | 2,3   | x86_64，ARM_64 |
| 龙蜥 AnolisOS           | 8.6 及以上   | x86_64（包括海光），ARM_64（鲲鹏、飞腾）|
| KylinOS                 | V10         | x86_64（包括海光），ARM_64（鲲鹏、飞腾） |
| 统信 UOS                | V20         | x86_64（包括海光），ARM_64（鲲鹏、飞腾）|
| 中科方德 NFSChina        | 4.0 及以上  | x86_64（包括海光），ARM_64（鲲鹏、飞腾）|
| 浪潮 Inspur kos          | 5.8        | x86_64（包括海光），ARM_64（鲲鹏、飞腾）|
| CentOS / Red Hat Enterprise Linux | 7.2 及以上 | x86_64（包括海光），ARM_64（鲲鹏、飞腾）|
| SUSE Enterprise Linux     | 12SP3 及以上 | x86_64（包括海光）|
| Debian                    | 8.3 及以上   | x86_64（包括海光）|

<main id="notice" type='explain'>
  <h4>说明</h4>
  <p>操作系统需要配置网络和软件管理器（ yum 或 zypper 源）。</p>
</main>

## OceanBase 服务器 BIOS 设置

### 特殊设置

* 在 Intel x86 架构的环境中：

  * 建议关闭 NUMA。

  * 建议修改配置文件 `/etc/sysctl.conf`，将参数 `vm.swappiness` 设置为 `0`，方法如下：

    ```bash
    [root@xxx /]
    $vi /etc/sysctl.conf
    vm.swappiness = 0
    ```

    应用 sysctl.conf 配置文件里的值：

    ```bash
    [root@xxx /]
    $sysctl -p    
    ```

* 在 AMD 或者 ARM 架构的环境中，建议开启 Numa。

* 在 ARM 和海光架构的环境中，建议修改配置文件 `/etc/sysctl.conf`，将参数 `kernel.numa_balancing`、`vm.zone_reclaim_mode` 和 `vm.swappiness` 设置为 `0`，方法如下：
  
  ```bash
  [root@xxx /]
  $vi /etc/sysctl.conf
  kernel.numa_balancing = 0
  vm.zone_reclaim_mode = 0
  vm.swappiness = 0
  ```

  应用 sysctl.conf 配置文件里的值：

  ```bash
  [root@xxx /]
  $sysctl -p
  ```

### BIOS 需要关闭以下选项

* Cstate

* Pstate

* EIST

* Power saving

### BIOS 需要配置以下选项

* Automatic Power on After Power Loss: Always on

* Intel Virtualization Technology：开启

* Hyper-threading：开启

* Hardware prefetcher：开启

* VT-d：开启

* SR-IOV：开启

* Turbo Mode：开启

* Energy performance：开启最大 performance

  <main id="notice" type='explain'>
    <h4>说明</h4>
    <p>不同的服务器修改 BIOS 的方式不同，具体操作请参见服务器操作手册。</p>
  </main>

## OceanBase 服务器内核参数设置

|       参数       | 允许的取值范围 | 推荐值   |  说明  |
| ---------------- | ------------ |  ------ | ------ |
| vm.max_map_count | [327680, +∞) | 655360 | 用于设置一个进程可拥有的最大内存映射区域数量。|
| vm.min_free_kbytes | [32768, 2097152] | 2097152 <main id="notice" type='notice'><h4>注意</h4><p>当您的部署服务器物理内存小于等于 8GB 时（比如在小规格服务器上部署 observer 进程或仲裁服务），建议该参数 <code>vm.min_free_kbytes</code> 保持默认值，不要进行更改。</p></main>| 用于设置系统保留的最小空闲内存量，以防止内存碎片化。|
| vm.overcommit_memory | 0 | 0 | 用于控制内存过量提交机制（Overcommit），指定当内存不足时是否允许过量提交内存。|
| fs.file-max | [6573688, +∞) | N/A | 用于设置系统允许打开的最大文件数。<main id="notice" type='explain'><h4>说明</h4><p><code>fs.file-max</code> 是对整个系统的文件描述符限制，而不是针对个别用户。</p></main> |
| ulimit.open files | <ul><li>soft nofile 655300</li><li>hard nofile 655300</li></ul> | <ul><li>soft nofile 655300</li><li>hard nofile 655300</li></ul> | 用于设置用户可同时打开的最大文件描述符数。|
| ulimit.max_user_processes| <ul><li>soft nproc 655300</li><li>hard nproc 655300</li></ul> | <ul><li>soft nproc 655300</li><li>hard nproc 655300</li></ul> | 用于设置用户可以创建的最大进程数。|
| ulimit.core file size | <ul><li>soft core unlimited</li><li>hard core unlimited</li></ul> | <ul><li>soft core unlimited</li><li>hard core unlimited</li></ul> | 用于设置核心转储文件（core dump）的最大大小。 <main id="notice" type='explain'><h4>说明</h4><p>该参数在严格和宽松检查模式下不符合范围都打 <code>warning</code>。</p></main> |
| ulimit.stack | <ul><li>soft stack > 1M </li><li>hard stack > 1M</li></ul> | <ul><li>soft stack unlimited</li><li>hard stack unlimited</li></ul> | 用于设置系统的栈大小的参数，通常使用 ulimit 命令进行设置。一般来说，栈大小的限制是一个弱限制，大于 1M 的大小通常就足够。|
| current_clocksource | N/A | tsc | 用于显示当前系统使用的时钟源。|

## 磁盘挂载

* OCP 服务器的磁盘挂载点要求如下表所示。

  |    挂载点     |       大小       |     用途      |          磁盘格式           |
  |------------|----------------|-------------|-------------------------|
  | /home      | 100 GB\~300 GB | 各组件运行日志盘    | 建议 ext4                 |
  | /data/log1 | 内存大小的 3\~4 倍   | OCP 元数据库日志盘 | 建议 ext4                 |
  | /data/1    | 取决于所需存储的数据大小   | OCP 元数据库数据盘 | 建议 ext4，大于 16 TB 使用 xfs |
  | /docker    | 200 GB\~500 GB | Docker 根目录  | 建议 ext4                 |

* OBServer 节点的磁盘挂载点要求如下表所示。

  |    挂载点     |       大小       |       用途       |         文件系统格式          |
  |------------|----------------|----------------|-------------------------|
  | /home      | 100 GB\~300 GB | observer 进程运行日志盘 | 建议 ext4                 |
  | /data/log1 | 内存大小的 3\~4 倍   | observer 进程日志盘   | 建议 ext4                 |
  | /data/1    | 取决于所需存储的数据大小   | observer 进程数据盘   | 建议 ext4，大于 16 TB 使用 xfs |

  <main id="notice" type='explain'>
    <h4>说明</h4>
    <p>建议根目录不小于 50 GB，不建议单独挂载 /opt 和 /var 目录。如果使用 LVM，建议创建时使用条带化参数。示例如下：</p>
    <p><code>lvcreate -n data -L 3000G obvg --stripes=3 --stripesize=128</code></p>
  </main>

## 网卡设置

建议配置 2 块万兆网卡：

* bond 模式取名 bond0，绑定的模式可以选择 mode1 或 mode4，但建议选择 mode4。对于 mode4 模式，交换机需要配置 802.3ad 协议。
* 网卡名建议使用 eth0、eth1。
