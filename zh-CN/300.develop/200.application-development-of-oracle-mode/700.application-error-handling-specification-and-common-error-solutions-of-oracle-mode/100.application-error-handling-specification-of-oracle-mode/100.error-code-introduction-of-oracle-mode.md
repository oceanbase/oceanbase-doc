|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type|Oracle Mode|

# 错误码介绍

本节主要介绍 OceanBase 数据库中错误码的组成及含义。

不论你使用的是 Java 还是 C 驱动库连接 OceanBase 数据库，在执行任何 SQL 语句失败时，都会收到一个错误，表示执行失败。一个错误通常包含以下三个信息：

* 一个 32 位整数表示的错误码

* 一个 5 位字符组成的串，即 SQLSTATE

* 一个字符串，包含人可读的错误消息

例如，使用客户端 OBClient 连接 OceanBase 数据库后，执行 SQL 语句失败时，系统会在终端打印如下错误信息：

```shell
ERROR 1054 (42S22): Unknown column ‘haha’ in ‘field list’
```

其中，`1054` 为错误码，括号中的 `42S22` 为 SQLSTATE，冒号后面为具体的错误消息。

出于兼容性设计原则，对于同一个错误，在 MySQL 模式（`sys` 租户属于 MySQL 模式）和 Oracle 模式下可能返回不同的错误码。例如，OceanBase 内部错误码 `-5217` 表示 SQL 语句中引用了不存在的列名，它在两种租户模式下的表现如下表所示。

|   租户模式       | 错误码               |  SQLSTATE       |  错误消息                   |
|-----------------|-------------------|------------------|----------------------------|
|  MySQL          | 1054               |   42S22          |  Unknown column            |
|  Oracle         | 904，即 OBE-00904  |   42S22          |  invalid identifier        |

使用错误码解析工具 ob_error 10，可以查询错误码的含义，以及内外错误码的映射关系。关于错误码解析工具 ob_error 的详细介绍，请参见 [ob_error](../../../../700.reference/1500.Components-and-Tools/100.manage/300.ob-error.md)。

## SQLSTATE

SQLSTATE 是 SQL 标准规定的错误码，它是由 5 个数字或大写拉丁字母组成的字符串值。这 5 个数字的前两位表示大的错误类别，后面三位表示更具体的错误原因。例如，`00` 表示成功，`01` 表示告警，`02` 表示未找到，`22` 表示数据类错误，`42` 表示语法错误等。因此，对于同一个错误，OceanBase 数据库在 MySQL 模式和 Oracle 模式下会返回相同的 SQLSTATE。

理论上，所有遵循 SQL 标准的数据库都会返回一致的 SQLSTATE，这样应用程序的错误处理逻辑就可以兼容不同的数据库。

## 错误码

虽然已经有了 SQLSTATE 这种 SQL 标准规定的错误码，但是由于标准的发展总是滞后于数据库厂商的实践，各厂商往往需要定义自己的错误码（vendor code），以便甄别更详细的错误原因。并且，各厂商自己定义的错误码在不同数据库之间无法兼容。

在 OceanBase 数据库中，非兼容的自定义错误码对应的 SQLSTATE 一般都是 `HY000`。

## 错误消息

错误消息提供了人类友好的提示信息，只对人友好。由于错误消息可能会随着版本的演变而变化，并且，相同的错误在不同语言环境的设置下可能会以本地语言显示不同的错误消息，因此，一般来说，在应用程序中应该是基于错误码或 SQLSTATE 进行错误处理，而不应该基于错误消息。
