|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type||

# 全量旁路导入

本文介绍如何通过 `LOAD DATA` 语句和 `INSERT INTO SELECT` 语句实现全量旁路导入。

## 注意事项

在使用全量旁路导入时，有以下注意事项：

1. OceanBase 数据库从 V4.3.0 版本开始支持 LOB 数据类型的旁路导入。
2. 旁路导入期间会加表锁，表无法被写入其他数据，整个过程中表是只读的。
3. 当导入的数据量小于 Memtable 时，旁路导入没有优势。因为旁路导入写磁盘，比不过只写内存不需要转储或合并的场景。
4. 全量旁路导入适用于大表首次导入、10 GB~TB 级别的数据迁移以及 CPU 和内存都不是特别充裕的场景，因为旁路导入的执行路径短，可以省 CPU 开销。
5. `LOAD DATA` 语句支持在多行事务中运行，但由于其属于 DDL 操作，因此在执行时会主动提交之前的事务。
6. 使用 `INSERT INTO SELECT` 语句旁路导入数据时，只支持 PDML（Parallel Data Manipulation Language，并行数据操纵语言），非 PDML 不能用旁路导入。

## 使用 LOAD DATA 语句旁路导入数据

`LOAD DATA` 语句通过使用 `append/direct()` Hint 来执行旁路导入。

<main id="notice" type='notice'>
  <h4>注意</h4>
   <p>OceanBase 数据库通过并行处理技术优化 <code>LOAD DATA</code> 的数据导入速率。该操作将数据分成多个子任务并行执行，每个子任务都视为独立的事务，执行顺序是不固定的。因此对于没有主键的表，数据写入顺序可能与原文件中的顺序不同。
   </p>
</main>

### 使用限制

* 在导入过程中无法同时执行两个写操作语句（即不能同时写一个表），因为导入过程中会先加表锁，并且整个导入过程中只能进行读操作。
* 不支持在触发器（Trigger）使用。
* 不支持含有生成列的表（某些索引会产生隐藏生成列，例如 KEY `idx_c2` (`c2`(16)) GLOBAL）。
* 不支持单行超过 2M 的数据导入。
* 不支持 Liboblog 和闪回查询（Flashback Query）。

### 使用语法

```sql
LOAD DATA /*+ [APPEND | DIRECT(need_sort,max_error,'full')] parallel(N) */ [REMOTE_OSS | LOCAL] INFILE 'file_name' INTO TABLE table_name [COMPRESSION]...
```

更多 `LOAD DATA` 语法的信息，请参见 [LOAD DATA](../../700.reference/500.sql-reference/100.sql-syntax/200.common-tenant-of-mysql-mode/600.sql-statement-of-mysql-mode/5900.load-data-of-mysql-mode.md)。

**参数解释：**

|参数|描述|
|------|------|
| APPEND \| DIRECT()  | 使用 Hint 启用旁路导入功能。<ul><li><code>APPEND</code> Hint 默认等同于使用的 <code>DIRECT(true, 0)</code>，同时可以实现在线收集统计信息（<code>GATHER_OPTIMIZER_STATISTICS</code> Hint）的功能。</li><li><code>direct()</code> 参数解释如下：<ul><li><code>need_sort</code>：表示写入的数据是否需要排序，值为 <code>bool</code> 类型：<ul><li><code>true</code>：表示需要排序。</li><li><code>false</code>：表示不需要排序。</li></ul></li><li><code>max_error</code>：表示最大容忍的错误行数。值为 <code>INT</code> 类型，超过这个数值导入任务执行会失败。</li><li><code>full</code>：表示全量旁路导入，可选项，取值须使用英文单引号包起来。</li></ul></li></ul>|
| parallel(N) | 加载数据的并行度，必填项，默认为 4。|
| REMOTE_OSS \| LOCAL | 可选项，<ul><li> <code>REMOTE_OSS</code> 用于指定是否从 OSS 文件系统读取数据。<main id="notice" type='notice'><h4>注意</h4><p>如果使用了此参数，<code>file_name</code> 必须是一个 OSS 的地址。</p></main>  </li><li> <code>LOCAL</code> 用于指定是否从客户端的本地文件系统读取数据。如果不使用 `LOCAL` 参数，那么将从服务器端（OBServer 节点）的文件系统读取数据。</li></ul> |
| file_name                        | 指定输入文件的路径和文件名。 <code>file_name</code> 有以下格式：<ul><li>导入文件在 OBServer 节点或客户端：<code>/\$PATH/\$FILENAME</code>。</li><li>导入文件在 OSS 上：<code>oss://\$PATH/\$FILENAME/?host=\$HOST&access_id=\$ACCESS_ID&access_key=\$ACCESSKEY</code>。</li></ul>     参数解释如下：<ul><li><code>\$PATH</code>：指定了存储桶中的文件路径，表示文件所在的目录。</li><li><code>\$FILENAME</code>：指定了文件的名称，表示要访问的具体文件。</li><li><code>\$HOST</code>：指定了 OSS 服务的主机名或 CDN 加速的域名，即要访问的 OSS 服务的地址。</li><li><code>\$ACCESS_ID</code>：指定了访问 OSS 服务所需的 Access Key ID，用于身份验证。</li><li><code>\$ACCESSKEY</code>：指定了访问 OSS 服务所需的 Access Key Secret，用于身份验证。</li></ul>    <main id="notice" type='explain'> <h4>说明</h4> <p>在导入 OSS 上的文件时，需要确保以下信息：<ul><li>确保访问 OSS 存储桶和文件的权限。你需要拥有足够的权限来读取指定的存储桶和文件。这通常需要在 OSS 控制台或通过 OSS API 设置访问权限，并将访问密钥（Access Key ID 和 Access Key Secret）配置为具有适当权限的凭据。</li><li>确保数据库服务器可以通过网络连接到指定的 <code>$HOST</code> 地址，以访问 OSS 服务。如果使用的是 OSS 服务的 CDN 加速域名，还需要确保 CDN 配置正确，并且网络连接正常。</li></ul></p> </main>  |
| table_name                       | 导入数据的表的名称，支持指定表任意列数目。  |
| COMPRESSION                      | 指定压缩文件格式，取值有<ul><li><code>AUTO</code>：根据文件名后缀自动探测压缩算法。<br>在使用 <code>AUTO</code> 参数时，不同的后缀名有对应的压缩格式。<ul><li><code>.gz</code>：对应 GZIP 压缩文件。</li><li><code>.deflate</code>：对应 DEFLATE 压缩文件。</li><li><code>.zst/.zstd</code>：对应 ZSTD 压缩文件。</li></ul></li><li><code>NONE</code>：表示文件没有压缩。</li><li><code>GZIP</code>：GZIP 压缩文件。</li><li><code>DEFLATE</code>：不带元数据的GZIP压缩文件。</li><li><code>ZSTD</code>：ZSTD 压缩文件。</li></ul>可以明确文件的压缩格式或者让程序根据文件名后缀来探测压缩格式。|

### 使用示例

  <main id="notice" type='explain'>
     <h4>说明</h4>
     <p>下面的示例是从服务器端文件导入数据的方法。OceanBase 数据库 <code>LOAD DATA</code> 语句旁路导入数据还支持加载本地文件（<code>LOCAL INFILE</code>）的方式。更多有关 <code>LOAD DATA LOCAL INFILE</code> 的示例信息，请参见 <a href="../700.migrate-data-from-csv-file-to-oceanbase-database/200.use-the-load-command-to-load-the-csv-data-file-to-the-oceanbase-database.md">使用 <code>LOAD DATA</code> 语句导入数据</a></p>
   </main>

:::tab
tab MySQL 模式

1. 登录到需要连接 OBServer 节点所在的机器上，在 `/home/admin` 目录下创建测试数据。

    <main id="notice" type='explain'>
    <h4>说明</h4>
    <p>OceanBase 数据库中的 <code>LOAD DATA</code> 语句仅支持加载 OBServer 节点本地的输入文件。因此，需要在导入之前将文件拷贝到某台 OBServer 上。</p>
    </main>

   1. 进入 OBServer 节点所在的机器。

      ```shell
      [xxx@xxx /home/admin]# ssh admin@10.10.10.1
      ```

   2. 创建测试数据 `tbl1.csv`。

      ```shell
      [admin@xxx /home/admin]# vi tbl1.csv
      1,11
      2,22
      3,33
      ```

2. 设置导入的文件路径。

    设置系统变量 `secure_file_priv`，配置导入或导出文件时可以访问的路径。

    <main id="notice" type='notice'>
      <h4>注意</h4>
      <p>由于安全原因，设置系统变量 <code>secure_file_priv</code> 时，只能通过本地 Socket 连接数据库执行修改该全局变量的 SQL 语句。更多信息，请参见 <a href="../../700.reference/800.configuration-items-and-system-variables/200.system-variable/300.global-system-variable/12000.secure_file_priv-global.md">secure_file_priv</a>。</p>
    </main>

    1. 登录到需要连接 OBServer 节点所在的机器上。

        ```shell
        [xxx@xxx /home/admin]# ssh admin@10.10.10.1
        ```

    2. 执行以下命令，通过本地 Unix Socket 连接方式连接租户 `mysql001`。

        ```shell
        obclient -S /home/admin/oceanbase/run/sql.sock -uroot@mysql001 -p******
        ```

    3. 设置导入路径为 `/home/admin`。

        ```shell
        obclient [(none)]> SET GLOBAL secure_file_priv = "/home/admin";
        Query OK, 0 rows affected
        ```

3. 重新连接数据库后，使用 `LOAD /*+ DIRECT */ DATA` 语句导入数据。

    1. 创建表 `tbl2`。

       ```shell
       obclient [test]> CREATE TABLE tbl2(col1 INT PRIMARY KEY,col2 INT);
       Query OK, 0 rows affected
       ```

    2. 查询表 `tbl2` 是否有数据，此时显示表为空。

       ```shell
       obclient [test]> SELECT * FROM tbl2;
       Empty set
       ```

    3. 使用旁路导入将 `tbl1.csv` 文件中的数据导入到表 `tbl2`。

       * 指定表 `tbl2` 的所有列导入数据。

         ```shell
         obclient [test]> LOAD DATA /*+ direct(true,1024,'full') parallel(16) */ INFILE '/home/admin/tbl1.csv' INTO TABLE tbl2 FIELDS TERMINATED BY ',';
         Query OK, 3 rows affected
         Records: 3  Deleted: 0  Skipped: 0  Warnings: 0
         ```

       * 指定表 `tbl2` 的指定任意列导入数据。例如指定 `col1`，`col2` 列。

         ```shell
         obclient [test]> LOAD DATA /*+ direct(true,1024,'full') parallel(16) */ INFILE '/home/admin/tbl1.csv' INTO TABLE tbl2 FIELDS TERMINATED BY ','(col1,col2);
         Query OK, 3 rows affected
         Records: 3  Deleted: 0  Skipped: 0  Warnings: 0
         ```

    4. 验证表 `tbl2` 中是否已导入数据。

       ```shell
       obclient [test]>  SELECT * FROM tbl2;
       ```

       查询结果如下：

       ```shell
        +------+------+
        | col1 | col2 |
        +------+------+
        |    1 |   11 |
        |    2 |   22 |
        |    3 |   33 |
        +------+------+
        3 rows in set
       ```

       结果显示表 `tbl2` 中已导入数据。

tab Oracle 模式

1. 登录到需要连接 OBServer 节点所在的机器上，在 `/home/admin` 目录下创建测试数据 `tbl1`。

    <main id="notice" type='explain'>
    <h4>说明</h4>
    <p>OceanBase 数据库中的 <code>LOAD DATA</code> 语句仅支持加载 OBServer 节点本地的输入文件。因此，需要在导入之前将文件拷贝到某台 OBServer 上。</p>
    </main>

   1. 进入 OBServer 节点所在的机器。

      ```shell
      [xxx@xxx /home/admin]# ssh admin@10.10.10.1
      ```

   2. 创建测试数据 `tbl1.csv`。

      ```shell
      [admin@xxx /home/admin]# vi tbl1.csv
      1,11
      2,22
      3,33
      ```

2. 设置导入的文件路径。

    设置系统变量 `secure_file_priv`，配置导入或导出文件时可以访问的路径。

    <main id="notice" type='notice'>
      <h4>注意</h4>
      <p>由于安全原因，设置系统变量 <code>secure_file_priv</code> 时，只能通过本地 Socket 连接数据库执行修改该全局变量的 SQL 语句。更多信息，请参见 <a href="../../700.reference/800.configuration-items-and-system-variables/200.system-variable/300.global-system-variable/12000.secure_file_priv-global.md">secure_file_priv</a>。</p>
    </main>

    1. 登录到需要连接 OBServer 节点所在的机器上。

        ```shell
        [xxx@xxx /home/admin]# ssh admin@10.10.10.1
        ```

    2. 执行以下命令，通过本地 Unix Socket 连接方式连接租户 `oracle001`。

        ```shell
        obclient -S /home/admin/oceanbase/run/sql.sock -usys@oracle001 -p******
        ```

    3. 设置导入路径为 `/home/admin`。

        ```shell
        obclient [(none)]> SET GLOBAL secure_file_priv = "/home/admin";
        Query OK, 0 rows affected
        ```

3. 重新连接数据库后，使用 `LOAD /*+ DIRECT */ DATA` 语句导入数据。

    1. 创建表 `tbl2`。

       ```shell
       obclient [test]> CREATE TABLE tbl2(col1 INT PRIMARY KEY,col2 INT);
       Query OK, 0 rows affected
       ```

    2. 查询表 `tbl2` 是否有数据，此时显示表为空。

       ```shell
       obclient [test]> SELECT * FROM tbl2;
       Empty set
       ```

    3. 使用旁路导入将 `tbl1.csv` 文件中的数据导入到表 `tbl2`。

       * 指定表 `tbl2` 的所有列导入数据。

         ```shell
         obclient [test]> LOAD DATA /*+ direct(true,1024,'full') parallel(16) */ INFILE '/home/admin/tbl1.csv' INTO TABLE tbl2 FIELDS TERMINATED BY ',';
         Query OK, 3 rows affected
         Records: 3  Deleted: 0  Skipped: 0  Warnings: 0
         ```

       * 指定表 `tbl2` 的指定任意列导入数据。例如指定 `col1`，`col2` 列。

         ```shell
         obclient [test]> LOAD DATA /*+ direct(true,1024,'full') parallel(16) */ INFILE '/home/admin/tbl1.csv' INTO TABLE tbl2 FIELDS TERMINATED BY ','(col1,col2);
         Query OK, 3 rows affected
         Records: 3  Deleted: 0  Skipped: 0  Warnings: 0
         ```

    4. 验证表 `tbl2` 中是否已导入数据。

       ```shell
       obclient [test]>  SELECT * FROM tbl2;
       ```

       查询结果如下：

       ```shell
        +------+------+
        | col1 | col2 |
        +------+------+
        |    1 |   11 |
        |    2 |   22 |
        |    3 |   33 |
        +------+------+
        3 rows in set
       ```

       结果显示表 `tbl2` 中已导入数据。

:::

## 使用 INSERT INTO SELECT 语句旁路导入数据

`INSERT INTO SELECT` 语句通过 Hint 使用 `append/direct()` 加上 `enable_parallel_dml` 来执行旁路导入。

### 使用限制

* 只支持 PDML（Parallel Data Manipulation Language，并行数据操纵语言），非 PDML 不能用旁路导入。有关并行 DML 的更多信息，参见 [并行 DML](../../700.reference/1000.performance-tuning-guide/500.sql-optimization/300.distributed-execution-plan/1000.parallel-dml.md)。
* 在导入过程中无法同时执行两个写操作语句（即不能同时写一个表），因为导入过程中会先加表锁，并且整个导入过程中只能进行读操作。
* 旁路导入属于 DDL 语句，无法在多行事务（包含多个操作的事务）中执行。
  * 不能在 Begin 中执行。
  * Autocommit 必须设置为 1。
* 不支持在触发器（Trigger）使用。
* 不支持含有生成列的表（某些索引会产生隐藏生成列，例如 KEY `idx_c2` (`c2`(16)) GLOBAL）。
* 不支持 Liboblog 和闪回查询（Flashback Query）。

### 使用语法

```sql
INSERT /*+ [APPEND |DIRECT(need_sort,max_error,'full')] enable_parallel_dml parallel(N) */ INTO  table_name select_sentence
```

更多 `INSERT INTO` 语法的信息，请参见 [INSERT（MySQL 模式）](../../700.reference/500.sql-reference/100.sql-syntax/200.common-tenant-of-mysql-mode/600.sql-statement-of-mysql-mode/5700.insert-sql-of-mysql-mode.md) 和 [INSERT（Oracle 模式）](../../700.reference/500.sql-reference/100.sql-syntax/300.common-tenant-of-oracle-mode/900.sql-statement-of-oracle-mode/200.dml-of-oracle-mode/200.insert-of-oracle-mode.md)。

**参数解释：**

|参数|描述|
|------|------|
| APPEND \| DIRECT()      | 使用 Hint 启用旁路导入功能。<ul><li><code>APPEND</code> Hint 默认等同于使用的 <code>DIRECT(true, 0)</code>，同时可以实现在线收集统计信息（<code>GATHER_OPTIMIZER_STATISTICS</code> Hint）的功能。</li><li><code>DIRECT()</code> 参数解释如下：<ul><li><code>need_sort</code>：表示写入的数据是否需要排序，值为 <code>bool</code> 类型：<ul><li><code>true</code>：表示需要排序。</li><li><code>false</code>：表示不需要排序。</li></ul></li><li><code>max_error</code>：表示最大容忍的错误行数。值为 <code>INT</code> 类型，超过这个数值导入任务执行会失败。</li><li><code>full</code>：表示全量旁路导入，可选项，取值须使用英文单引号包起来。</li></ul></li></ul>|
| enable_parallel_dml | 加载数据的并行度。<main id="notice" type='explain'><h4>说明</h4><p>一般情况下，<code>enable_parallel_dml</code> Hint 和 <code>parallel</code> Hint 必须配合使用才能开启并行 DML。不过，当目标表的 Schema 上指定了表级别的并行度时，仅需指定 <code>enable_parallel_dml</code> Hint。</p></main>|
| parallel(N) | 加载数据的并行度，必填项，取值是大于 1 的整数。|

### 使用示例

:::tab
tab MySQL 模式

使用旁路导入将表 `tbl2` 中的部分数据导入到 `tbl1` 中。

1. 查询表 `tbl1` 是否有数据，此时显示表为空。

   ```shell
   obclient [test]> SELECT * FROM tbl1;
   Empty set
   ```

2. 查询表 `tbl2` 是否有数据。

   ```shell
   obclient [test]> SELECT * FROM tbl2;
   ```

   查询到表 `tbl2` 有数据。

   ```shell
   +------+------+------+
   | col1 | col2 | col3 |
   +------+------+------+
   |    1 | a1   |   11 |
   |    2 | a2   |   22 |
   |    3 | a3   |   33 |
   +------+------+------+
   3 rows in set
   ```

3. 使用 `LOAD /*+ DIRECT */ DATA` 语句导入数据。

   ```shell
   obclient [test]> INSERT /*+ DIRECT(true, 0, 'full') enable_parallel_dml parallel(16) */ INTO tbl1 SELECT t2.col1,t2.col3 FROM tbl2 t2;
   Query OK, 3 rows affected
   Records: 3  Duplicates: 0  Warnings: 0
   ```

4. 验证表 `tbl1` 中是否已导入数据。

   ```shell
   obclient [test]> SELECT * FROM tbl1;
   ```

   查询结果如下：

   ```shell
   +------+------+
   | col1 | col2 |
   +------+------+
   |    1 |   11 |
   |    2 |   22 |
   |    3 |   33 |
   +------+------+
   3 rows in set
   ```

   结果显示表 `tbl1` 中已导入数据。

5. (可选)在 `EXPLAIN EXTENDED` 语句的返回结果的 `Note` 中，查看是否通过旁路导入写入的数据。

   ```shell
   obclient [test]> EXPLAIN EXTENDED INSERT /*+ direct(true, 0, 'full') enable_parallel_dml parallel(16) */ INTO tbl1 SELECT t2.col1,t2.col3 FROM tbl2 t2;
   ```

   返回结果如下：

   ```shell
   +--------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Query Plan                                                                                                                                                   |
   +--------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | ==============================================================================                                                                               |
   | |ID|OPERATOR                           |NAME           |EST.ROWS|EST.TIME(us)|                                                                               |
   | ------------------------------------------------------------------------------                                                                               |
   | |0 |PX COORDINATOR                     |               |3       |27          |                                                                               |
   | |1 |└─EXCHANGE OUT DISTR               |:EX10001       |3       |27          |                                                                               |
   | |2 |  └─INSERT                         |               |3       |26          |                                                                               |
   | |3 |    └─EXCHANGE IN DISTR            |               |3       |1           |                                                                               |
   | |4 |      └─EXCHANGE OUT DISTR (RANDOM)|:EX10000       |3       |1           |                                                                               |
   | |5 |        └─SUBPLAN SCAN             |ANONYMOUS_VIEW1|3       |1           |                                                                               |
   | |6 |          └─PX BLOCK ITERATOR      |               |3       |1           |                                                                               |
   | |7 |            └─TABLE FULL SCAN      |t2             |3       |1           |                                                                               |
   | ==============================================================================                                                                               |
   | Outputs & filters:                                                                                                                                           |
   | -------------------------------------                                                                                                                        |
   |   0 - output(nil), filter(nil), rowset=16                                                                                                                    |
   |   1 - output(nil), filter(nil), rowset=16                                                                                                                    |
   |       dop=16                                                                                                                                                 |
   |   2 - output(nil), filter(nil)                                                                                                                               |
   |       columns([{tbl1: ({tbl1: (tbl1.__pk_increment(0x7efa63627790), tbl1.col1(0x7efa63611980), tbl1.col3(0x7efa63611dc0))})}]), partitions(p0),              |
   |       column_values([T_HIDDEN_PK(0x7efa63627bd0)], [column_conv(INT,PS:(11,0),NULL,ANONYMOUS_VIEW1.col1(0x7efa63626f10))(0x7efa63627ff0)], [column_conv(INT, |
   |       PS:(11,0),NULL,ANONYMOUS_VIEW1.col3(0x7efa63627350))(0x7efa6362ff20)])                                                                                 |
   |   3 - output([T_HIDDEN_PK(0x7efa63627bd0)], [ANONYMOUS_VIEW1.col1(0x7efa63626f10)], [ANONYMOUS_VIEW1.col3(0x7efa63627350)]), filter(nil), rowset=16          |
   |   4 - output([T_HIDDEN_PK(0x7efa63627bd0)], [ANONYMOUS_VIEW1.col1(0x7efa63626f10)], [ANONYMOUS_VIEW1.col3(0x7efa63627350)]), filter(nil), rowset=16          |
   |       dop=16                                                                                                                                                 |
   |   5 - output([ANONYMOUS_VIEW1.col1(0x7efa63626f10)], [ANONYMOUS_VIEW1.col3(0x7efa63627350)]), filter(nil), rowset=16                                         |
   |       access([ANONYMOUS_VIEW1.col1(0x7efa63626f10)], [ANONYMOUS_VIEW1.col3(0x7efa63627350)])                                                                 |
   |   6 - output([t2.col1(0x7efa63625ed0)], [t2.col3(0x7efa63626780)]), filter(nil), rowset=16                                                                   |
   |   7 - output([t2.col1(0x7efa63625ed0)], [t2.col3(0x7efa63626780)]), filter(nil), rowset=16                                                                   |
   |       access([t2.col1(0x7efa63625ed0)], [t2.col3(0x7efa63626780)]), partitions(p0)                                                                           |
   |       is_index_back=false, is_global_index=false,                                                                                                            |
   |       range_key([t2.__pk_increment(0x7efa63656410)]), range(MIN ; MAX)always true                                                                            |
   | Used Hint:                                                                                                                                                   |
   | -------------------------------------                                                                                                                        |
   |   /*+                                                                                                                                                        |
   |                                                                                                                                                              |
   |       USE_PLAN_CACHE( NONE )                                                                                                                                 |
   |       PARALLEL(16)                                                                                                                                           |
   |       ENABLE_PARALLEL_DML                                                                                                                                    |
   |       DIRECT(TRUE, 0, 'FULL')                                                                                                                                |
   |   */                                                                                                                                                         |
   | Qb name trace:                                                                                                                                               |
   | -------------------------------------                                                                                                                        |
   |   stmt_id:0, stmt_type:T_EXPLAIN                                                                                                                             |
   |   stmt_id:1, INS$1                                                                                                                                           |
   |   stmt_id:2, SEL$1                                                                                                                                           |
   | Outline Data:                                                                                                                                                |
   | -------------------------------------                                                                                                                        |
   |   /*+                                                                                                                                                        |
   |       BEGIN_OUTLINE_DATA                                                                                                                                     |
   |       PARALLEL(@"SEL$1" "t2"@"SEL$1" 16)                                                                                                                     |
   |       FULL(@"SEL$1" "t2"@"SEL$1")                                                                                                                            |
   |       USE_PLAN_CACHE( NONE )                                                                                                                                 |
   |       PARALLEL(16)                                                                                                                                           |
   |       ENABLE_PARALLEL_DML                                                                                                                                    |
   |       OPTIMIZER_FEATURES_ENABLE('4.3.3.0')                                                                                                                   |
   |       DIRECT(TRUE, 0, 'FULL')                                                                                                                                |
   |       END_OUTLINE_DATA                                                                                                                                       |
   |   */                                                                                                                                                         |
   | Optimization Info:                                                                                                                                           |
   | -------------------------------------                                                                                                                        |
   |   t2:                                                                                                                                                        |
   |       table_rows:3                                                                                                                                           |
   |       physical_range_rows:3                                                                                                                                  |
   |       logical_range_rows:3                                                                                                                                   |
   |       index_back_rows:0                                                                                                                                      |
   |       output_rows:3                                                                                                                                          |
   |       table_dop:16                                                                                                                                           |
   |       dop_method:Global DOP                                                                                                                                  |
   |       avaiable_index_name:[tbl2]                                                                                                                             |
   |       stats info:[version=0, is_locked=0, is_expired=0]                                                                                                      |
   |       dynamic sampling level:0                                                                                                                               |
   |       estimation method:[DEFAULT, STORAGE]                                                                                                                   |
   |   Plan Type:                                                                                                                                                 |
   |       DISTRIBUTED                                                                                                                                            |
   |   Note:                                                                                                                                                      |
   |       Degree of Parallelism is 16 because of hint                                                                                                            |
   |       Direct-mode is enabled in insert into select                                                                                                           |
   +--------------------------------------------------------------------------------------------------------------------------------------------------------------+
   77 rows in set (0.009 sec)
   ```

tab Oracle 模式

使用旁路导入将表 `tbl4` 中的部分数据导入到 `tbl3` 中。

1. 查询表 `tbl3` 是否有数据，此时显示表为空。

   ```shell
   obclient [test]> SELECT * FROM tbl3;
   Empty set
   ```

2. 查询表 `tbl4` 是否有数据。

   ```shell
   obclient [test]> SELECT * FROM tbl4;
   ```

   查询到表 `tbl4` 有数据。

   ```shell
   +------+------+------+
   | COL1 | COL2 | COL3 |
   +------+------+------+
   |    1 | a1   |   11 |
   |    2 | a2   |   22 |
   |    3 | a3   |   33 |
   +------+------+------+
   3 rows in set (0.000 sec)
   ```

3. 使用 `LOAD /*+ DIRECT */ DATA` 语句导入数据。

   ```shell
   obclient [test]> INSERT /*+ direct(true, 0, 'full') enable_parallel_dml parallel(16) */ INTO tbl3 SELECT t2.col1, t2.col3 FROM tbl4 t2 WHERE ROWNUM <= 10000;
   Query OK, 3 rows affected
   Records: 3  Duplicates: 0  Warnings: 0
   ```

4. 验证表 `tbl3` 中是否已导入数据。

   ```shell
   obclient [test]> SELECT * FROM tbl3;
   ```

   查询结果如下：

   ```shell
   +------+------+
   | col1 | col3 |
   +------+------+
   |    1 |   11 |
   |    2 |   22 |
   |    3 |   33 |
   +------+------+
   3 rows in set
   ```

   结果显示表 `tbl3` 中已导入数据。

5. (可选)在 `EXPLAIN EXTENDED` 语句的返回结果的 `Note` 中，查看是否通过旁路导入写入的数据。

   ```shell
   obclient [test]> EXPLAIN EXTENDED INSERT /*+ direct(true, 0, 'full') enable_parallel_dml parallel(16) */ INTO tbl3 SELECT t2.col1,t2.col3 FROM tbl4 t2;
   ```

   返回结果如下：

   ```shell
   +----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Query Plan                                                                                                                                                                                                                 |
   +----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | ===================================================================================                                                                                                                                        |
   | |ID|OPERATOR                                |NAME           |EST.ROWS|EST.TIME(us)|                                                                                                                                        |
   | -----------------------------------------------------------------------------------                                                                                                                                        |
   | |0 |OPTIMIZER STATS MERGE                   |               |3       |29          |                                                                                                                                        |
   | |1 |└─PX COORDINATOR                        |               |3       |29          |                                                                                                                                        |
   | |2 |  └─EXCHANGE OUT DISTR                  |:EX10001       |3       |27          |                                                                                                                                        |
   | |3 |    └─INSERT                            |               |3       |27          |                                                                                                                                        |
   | |4 |      └─OPTIMIZER STATS GATHER          |               |3       |1           |                                                                                                                                        |
   | |5 |        └─EXCHANGE IN DISTR             |               |3       |1           |                                                                                                                                        |
   | |6 |          └─EXCHANGE OUT DISTR (RANDOM) |:EX10000       |3       |1           |                                                                                                                                        |
   | |7 |            └─SUBPLAN SCAN              |ANONYMOUS_VIEW1|3       |1           |                                                                                                                                        |
   | |8 |              └─PX BLOCK ITERATOR       |               |3       |1           |                                                                                                                                        |
   | |9 |                └─COLUMN TABLE FULL SCAN|T2             |3       |1           |                                                                                                                                        |
   | ===================================================================================                                                                                                                                        |
   | Outputs & filters:                                                                                                                                                                                                         |
   | -------------------------------------                                                                                                                                                                                      |
   |   0 - output(nil), filter(nil), rowset=16                                                                                                                                                                                  |
   |   1 - output([column_conv(NUMBER,PS:(-1,0),NULL,ANONYMOUS_VIEW1.COL1(0x7ef8f6027720))(0x7ef8f60287f0)], [column_conv(NUMBER,PS:(-1,0),NULL,ANONYMOUS_VIEW1.COL3(0x7ef8f6027b60))(0x7ef8f6030710)]), filter(nil), rowset=16 |
   |   2 - output([column_conv(NUMBER,PS:(-1,0),NULL,ANONYMOUS_VIEW1.COL1(0x7ef8f6027720))(0x7ef8f60287f0)], [column_conv(NUMBER,PS:(-1,0),NULL,ANONYMOUS_VIEW1.COL3(0x7ef8f6027b60))(0x7ef8f6030710)]), filter(nil), rowset=16 |
   |       dop=16                                                                                                                                                                                                               |
   |   3 - output([column_conv(NUMBER,PS:(-1,0),NULL,ANONYMOUS_VIEW1.COL1(0x7ef8f6027720))(0x7ef8f60287f0)], [column_conv(NUMBER,PS:(-1,0),NULL,ANONYMOUS_VIEW1.COL3(0x7ef8f6027b60))(0x7ef8f6030710)]), filter(nil)            |
   |       columns([{TBL3: ({TBL3: (TBL3.__pk_increment(0x7ef8f6027fa0), TBL3.COL1(0x7ef8f6011d50), TBL3.COL3(0x7ef8f6012190))})}]), partitions(p0),                                                                            |
   |       column_values([T_HIDDEN_PK(0x7ef8f60283e0)], [column_conv(NUMBER,PS:(-1,0),NULL,ANONYMOUS_VIEW1.COL1(0x7ef8f6027720))(0x7ef8f60287f0)], [column_conv(NUMBER,                                                         |
   |       PS:(-1,0),NULL,ANONYMOUS_VIEW1.COL3(0x7ef8f6027b60))(0x7ef8f6030710)])                                                                                                                                               |
   |   4 - output([column_conv(NUMBER,PS:(-1,0),NULL,ANONYMOUS_VIEW1.COL1(0x7ef8f6027720))(0x7ef8f60287f0)], [column_conv(NUMBER,PS:(-1,0),NULL,ANONYMOUS_VIEW1.COL3(0x7ef8f6027b60))(0x7ef8f6030710)],                         |
   |        [T_HIDDEN_PK(0x7ef8f60283e0)]), filter(nil), rowset=16                                                                                                                                                              |
   |   5 - output([T_HIDDEN_PK(0x7ef8f60283e0)], [ANONYMOUS_VIEW1.COL1(0x7ef8f6027720)], [ANONYMOUS_VIEW1.COL3(0x7ef8f6027b60)]), filter(nil), rowset=16                                                                        |
   |   6 - output([T_HIDDEN_PK(0x7ef8f60283e0)], [ANONYMOUS_VIEW1.COL1(0x7ef8f6027720)], [ANONYMOUS_VIEW1.COL3(0x7ef8f6027b60)]), filter(nil), rowset=16                                                                        |
   |       dop=16                                                                                                                                                                                                               |
   |   7 - output([ANONYMOUS_VIEW1.COL1(0x7ef8f6027720)], [ANONYMOUS_VIEW1.COL3(0x7ef8f6027b60)]), filter(nil), rowset=16                                                                                                       |
   |       access([ANONYMOUS_VIEW1.COL1(0x7ef8f6027720)], [ANONYMOUS_VIEW1.COL3(0x7ef8f6027b60)])                                                                                                                               |
   |   8 - output([T2.COL1(0x7ef8f60264c0)], [T2.COL3(0x7ef8f6026f90)]), filter(nil), rowset=16                                                                                                                                 |
   |   9 - output([T2.COL1(0x7ef8f60264c0)], [T2.COL3(0x7ef8f6026f90)]), filter(nil), rowset=16                                                                                                                                 |
   |       access([T2.COL1(0x7ef8f60264c0)], [T2.COL3(0x7ef8f6026f90)]), partitions(p0)                                                                                                                                         |
   |       is_index_back=false, is_global_index=false,                                                                                                                                                                          |
   |       range_key([T2.__pk_increment(0x7ef8f60584a0)]), range(MIN ; MAX)always true                                                                                                                                          |
   | Used Hint:                                                                                                                                                                                                                 |
   | -------------------------------------                                                                                                                                                                                      |
   |   /*+                                                                                                                                                                                                                      |
   |                                                                                                                                                                                                                            |
   |       USE_PLAN_CACHE( NONE )                                                                                                                                                                                               |
   |       PARALLEL(16)                                                                                                                                                                                                         |
   |       ENABLE_PARALLEL_DML                                                                                                                                                                                                  |
   |       DIRECT(TRUE, 0, 'FULL')                                                                                                                                                                                              |
   |   */                                                                                                                                                                                                                       |
   | Qb name trace:                                                                                                                                                                                                             |
   | -------------------------------------                                                                                                                                                                                      |
   |   stmt_id:0, stmt_type:T_EXPLAIN                                                                                                                                                                                           |
   |   stmt_id:1, INS$1                                                                                                                                                                                                         |
   |   stmt_id:2, SEL$1                                                                                                                                                                                                         |
   | Outline Data:                                                                                                                                                                                                              |
   | -------------------------------------                                                                                                                                                                                      |
   |   /*+                                                                                                                                                                                                                      |
   |       BEGIN_OUTLINE_DATA                                                                                                                                                                                                   |
   |       PARALLEL(@"SEL$1" "T2"@"SEL$1" 16)                                                                                                                                                                                   |
   |       FULL(@"SEL$1" "T2"@"SEL$1")                                                                                                                                                                                          |
   |       USE_COLUMN_TABLE(@"SEL$1" "T2"@"SEL$1")                                                                                                                                                                              |
   |       USE_PLAN_CACHE( NONE )                                                                                                                                                                                               |
   |       PARALLEL(16)                                                                                                                                                                                                         |
   |       ENABLE_PARALLEL_DML                                                                                                                                                                                                  |
   |       OPTIMIZER_FEATURES_ENABLE('4.3.3.0')                                                                                                                                                                                 |
   |       DIRECT(TRUE, 0, 'FULL')                                                                                                                                                                                              |
   |       END_OUTLINE_DATA                                                                                                                                                                                                     |
   |   */                                                                                                                                                                                                                       |
   | Optimization Info:                                                                                                                                                                                                         |
   | -------------------------------------                                                                                                                                                                                      |
   |   T2:                                                                                                                                                                                                                      |
   |       table_rows:3                                                                                                                                                                                                         |
   |       physical_range_rows:3                                                                                                                                                                                                |
   |       logical_range_rows:3                                                                                                                                                                                                 |
   |       index_back_rows:0                                                                                                                                                                                                    |
   |       output_rows:3                                                                                                                                                                                                        |
   |       table_dop:16                                                                                                                                                                                                         |
   |       dop_method:Global DOP                                                                                                                                                                                                |
   |       avaiable_index_name:[TBL4]                                                                                                                                                                                           |
   |       stats info:[version=0, is_locked=0, is_expired=0]                                                                                                                                                                    |
   |       dynamic sampling level:0                                                                                                                                                                                             |
   |       estimation method:[DEFAULT, STORAGE]                                                                                                                                                                                 |
   |   Plan Type:                                                                                                                                                                                                               |
   |       DISTRIBUTED                                                                                                                                                                                                          |
   |   Note:                                                                                                                                                                                                                    |
   |       Degree of Parallelism is 16 because of hint                                                                                                                                                                          |
   +----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   82 rows in set (0.006 sec)
   ```

:::

## 相关文档

* [表与表之间的数据迁移](../1000.use-sql-statements-migrate-data/100.data-migration-between-tables.md)
* [SQL 执行计划简介](../../700.reference/1000.performance-tuning-guide/500.sql-optimization/200.sql-execution-plan/100.introduction-to-sql-execution-plans.md)
* [连接方式概述](../../300.develop/100.application-development-of-mysql-mode/100.connect-to-oceanbase-database-of-mysql-mode/100.connection-methods-overview-of-mysql-mode.md)
* [删除表](../../700.reference/300.database-object-management/200.manage-object-of-oracle-mode/100.manage-tables-of-oracle-mode/800.delete-a-table-of-oracle-mode.md)
