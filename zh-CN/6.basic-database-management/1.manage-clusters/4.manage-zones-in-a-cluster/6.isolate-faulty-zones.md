隔离故障 Zone
==============================

当 Zone 发生故障时，您可以隔离故障 Zone。隔离后，新的读写请求不会路由到该故障 Zone 内的进程上。

当 Zone 故障后，您可以通过隔离操作将故障 Zone 上的 Leader 切换到其他机器上，以此尝试恢复用户的写服务和集群内的日志同步。待集群恢复正常后，尝试通过先 Stop Zone 后再重启故障机器的方式来解决问题。

隔离故障 Zone 的 SQL 语句如下：

```sql
obclient> ALTER SYSTEM ISOLATE ZONE 'zone_name';
```

该语句仅支持在 `sys` 租户中执行。

示例：

1. 使用 `root` 用户登录数据库的 `sys` 租户。

2. 执行以下命令，隔离故障的机器。

   ```sql
   obclient> ALTER SYSTEM ISOLATE ZONE 'zone1';
   ```

   SQL 语句执行成功，则表示隔离故障 Zone 的操作执行成功。同时，可以看到 `__all_zone` 内部表中，该隔离 Zone 的 `name` 列中 `status` 字段为 `stopped`，表示该 Zone 处于 `stopped`状态。

   查看 `__all_zone` 内部表的示例如下：

   ```sql
   obclient> SELECT * FROM oceanbase.__all_zone WHERE zone= 'zone1';
   +----------------------------+----------------------------+-------+---------------------+------------------+-----------+
   | gmt_create                 | gmt_modified               | zone  | name                | value            | info      |
   +----------------------------+----------------------------+-------+---------------------+------------------+-----------+
   | 2021-11-22 18:00:13.814701 | 2022-01-04 02:00:38.221218 | zone1 | all_merged_version  |               45 |           |
   | 2021-11-22 18:00:13.814422 | 2022-01-04 02:00:21.210032 | zone1 | broadcast_version   |               45 |           |
   | 2021-11-22 18:00:13.815255 | 2021-11-22 18:00:22.691700 | zone1 | idc                 |                0 | BJ1       |
   | 2021-11-22 18:00:13.814904 | 2022-01-04 02:00:38.220994 | zone1 | is_merge_timeout    |                0 |           |
   | 2021-11-22 18:00:13.814331 | 2022-01-04 02:00:38.220232 | zone1 | is_merging          |                0 |           |
   | 2021-11-22 18:00:13.814600 | 2022-01-04 02:00:38.220771 | zone1 | last_merged_time    | 1641232838219704 |           |
   | 2021-11-22 18:00:13.814510 | 2022-01-04 02:00:38.220535 | zone1 | last_merged_version |               45 |           |
   | 2021-11-22 18:00:13.814809 | 2022-01-04 02:00:21.210365 | zone1 | merge_start_time    | 1641232821208596 |           |
   | 2021-11-22 18:00:13.815080 | 2022-01-04 02:00:38.221669 | zone1 | merge_status        |                0 | IDLE      |
   | 2021-11-22 18:00:13.815168 | 2021-11-22 18:00:13.815168 | zone1 | region              |                0 | BEIJING   |
   | 2021-11-22 18:00:13.814239 | 2021-11-22 18:00:13.814239 | zone1 | status              |                2 | STOPPED   |
   | 2021-11-22 18:00:13.814993 | 2021-11-22 18:00:13.814993 | zone1 | suspend_merging     |                0 |           |
   | 2021-11-22 18:00:13.815343 | 2021-11-22 18:00:13.815343 | zone1 | zone_type           |                0 | ReadWrite |
   +----------------------------+----------------------------+-------+---------------------+------------------+-----------+
   13 rows in set
   ```

隔离故障的 Zone 后，如果需要解除隔离状态，您可以通过执行 `ALTER SYSTEM START ZONE 'zone1'` 命令来完成。
