修改合并配置
===========================

本节主要介绍合并相关的参数及参数的修改方法。

合并参数
-------------------------

合并相关参数说明如下表所示。

|              配置项              |                                                    描述                                                    |  默认值  |                                                                                                                               取值范围                                                                                                                               |
|-------------------------------|----------------------------------------------------------------------------------------------------------|-------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| major_freeze_duty_time        | 每天定时合并的时间。                                                                                               | 02:00 | \[00:00,24:00\]                                                                                                                                                                                                                                                  |
| major_compact_trigger         | 等同于 `minor_freeze_times`。                                                                                | 5     | \[0,65535\]                                                                                                                                                                                                                                                      |
| merge_stat_sampling_ratio     | 合并时统计信息采样率，当设置为 `0` 时则关闭统计信息的采集。                                                                         | 100   | \[0,100\]                                                                                                                                                                                                                                                        |
| merge_thread_count            | 合并线程数。                                                                                                   | 0     | \[0, 256\]                                                                                                                                                                                                                                                       |
| enable_merge_by_turn          | 是否开启轮转合并。                                                                                                | false | *true：开启* false：不开启                                                                                                                                                       |
| zone_merge_order              | 轮转合并开启时 Zone 的合并顺序。                                                                                      | Null  | Null                                                                                                                                                                                                                                                             |
| zone_merge_concurrency        | 并发合并的 Zone 的数量。                                                                                          | 0     | \[0,+∞\]                                                                                                                                                                                                                                                         |
| default_progressive_merge_num | 建表时默认的合并行为。                                                                                              | 0     | \[0, +∞)  其中： *0 ：表示执行渐进合并，且渐进合并的次数为 100*  1：表示强制执行全量合并，不执行渐进合并   * 大于 1 ：表示发生 Schema 变更时按照指定轮次做渐进合并    |
| enable_manual_merge           | 是否开启手动合并。 **说明**  `enable_manual_merge` 参数设置为开启后，表示需要手动对集群的 Zone 逐个进行合并。 | false | *true：开启* false：不开启                                                                                                                                                       |
| max_kept_major_version_number | 存储保留最大合并版本数量。                                                                                            | 2     | \[1, 16\]                                                                                                                                                                                                                                                        |
| zone_merge_timeout            | Zone 合并的超时时间。                                                                                            | 3h    | \[1s, +∞)                                                                                                                                                                                                                                                        |
| merger_check_interval         | 每个 Zone 的合并进度检查间隔。                                                                                       | 10m   | \[10s, 60m\]                                                                                                                                                                                                                                                     |
| merger_completion_percentage  | 合并好的分区数或数据大小比例。                                                                                          | 100   | \[5, 100\]                                                                                                                                                                                                                                                       |
| enable_global_freeze_trigger  | 自动触发全局冻结的开关。如果开启，当数据内存占用超过 `freeze_trigger_percentage` 的值时，自动触发全局冻结和合并。                                  | false | *true：开启* false：不开启                                                                                                                                                       |

此外，OCP 从 V2.4.x 版本开始已支持每日合并时间、合并线程数、合并超时、是否启用轮转合并及轮转合并并发度的设置，具体操作请参见对应版本的《OCP 用户指南》文档中 **合并管理** 章节的内容。

修改方法
-------------------------

### 通过 SQL 语句修改合并配置

1. 使用 `root` 用户登录到数据库的 `sys` 租户。

2. 通过以下 SQL 语句修改合并配置。

   示例如下：

   ```sql
   obclient>ALTER SYSTEM SET major_freeze_duty_time='03:00';
   ```

3. 修改成功后，可以通过 `SHOW PARAMETERS` 语句查看是否修改成功。

   示例如下：

   ```sql
   obclient>SHOW PARAMETERS LIKE 'major_freeze_duty_time';
   ```

### 通过 OCP 修改合并配置

您也可以通过 OCP 来修改每日合并时间、合并线程数、合并超时、是否启用轮转合并及轮转合并并发度等合并配置。

1. 登录 OCP。

   默认进入 **集群概览** 页面。

2. 在 **集群列表** 中找到待设置的集群并单击集群名。

   进入集群 **总览** 页面。

3. 在左侧导航栏上，单击 **合并管理** 。

4. 在 **合并管理** 页面，单击 **合并配置** 页签。

5. 在 合并策略 区域右上角，单击 **编辑** 。

   ![修改合并配置](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/9900849361/p320201.png)

6. 根据需要，修改合并参数。

7. 单击 **保存** 。
