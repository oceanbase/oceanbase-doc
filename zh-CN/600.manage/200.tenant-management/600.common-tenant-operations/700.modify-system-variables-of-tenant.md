|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type||

# 修改租户系统变量

通过系统变量的设置可以使 OceanBase 数据库的行为符合业务的要求。本文介绍如何修改租户系统变量。

租户的系统变量可以通过 `SET` 语句修改。

* 设置 Session 级别的变量仅对当前 Session 有效，对其他 Session 无效。
* 设置 Global 级别的变量对当前 Session 无效，需要重新登录后，建立新的 Session 才会生效。

  <main id="notice" type='notice'>
   <h4>注意</h4>
   <p>设置 Global 级别变量时，对于 MySQL 租户，要求当前用户拥有 <code>SUPER</code> 权限或 <code>ALTER SYSTEM</code> 权限；对于 Oracle 租户，要求当前用户拥有 <code>ALTER SYSTEM</code> 权限。设置前，请确认您的权限。用户权限的详细说明，参见 <a href="../../500.security-and-permissions/300.access-control/200.user-and-permission/100.user-and-permission-overview.md">用户和权限概述</a>。</p>
  </main>

下文示例中的系统变量 `ob_query_timeout` 用于设置对 SQL 语句进行查询操作的超时时间，单位是微秒。在进行大数据查询操作时，就可以通过调大系统变量 `ob_query_timeout` 的值，避免查询超时导致语句执行失败。

## 修改 Session 级别的系统变量

1. 使用管理员用户登录到集群的用户租户。

   <main id="notice" type='explain'>
   <h4>说明</h4>
   <p>MySQL 模式的默认管理员用户为 <code>root</code> 用户；Oracle 模式的默认管理员用户为 <code>SYS</code> 用户。 </p>
   </main>

   以登录 `mq_t1` 租户为例：

    ```shell
    obclient -h172.30.xx.xx -P2883 -uroot@mq_t1#cluster -p**** -A
    ```

2. 查询租户 Session 级别的系统变量。

      ```shell
      obclient [(none)]> SHOW VARIABLES LIKE 'ob_query_timeout';
      ```

      查询结果如下：

      ```shell
      +------------------+----------+
      | Variable_name    | Value    |
      +------------------+----------+
      | ob_query_timeout | 10000000 |
      +------------------+----------+
      1 row in set
      ```

3. 通过 `SET` 修改 Session 级别变量值。

    :::tab
    tab MySQL 模式

    MySQL 模式支持通过以下方式修改 Session 级别变量：

    ```shell
    obclient [oceanbase]> SET ob_query_timeout = 20000000;
    ```

    或者

    ```shell
    obclient [oceanbase]> SET ob_query_timeout := 20000000;
    ```    

    tab Oracle 模式

    Oracle 模式支持通过以下方式修改 Session 级别变量：

    ```shell
    obclient [SYS]> SET ob_query_timeout = 20000000;
    ```

    或者

    ```shell
    obclient [SYS]> ALTER SESSION SET ob_query_timeout = 20000000;
    ```

    :::

4. 查看修改结果。

    ```sql
    obclient [(none)]> SHOW VARIABLES WHERE variable_name LIKE 'ob_query_timeout';
    ```

    查询结果如下：

    ```shell
    +------------------+----------+
    | Variable_name    | Value    |
    +------------------+----------+
    | ob_query_timeout | 20000000 |
    +------------------+----------+
    1 row in set
    ```

## 修改 Global 级别的系统变量

1. 使用管理员用户登录到集群的用户租户。

   <main id="notice" type='explain'>
   <h4>说明</h4>
   <p>MySQL 模式的默认管理员用户为 <code>root</code> 用户；Oracle 模式的默认管理员用户为 <code>SYS</code> 用户。 </p>
   </main>

   以登录 `mq_t1` 租户为例：

    ```shell
    obclient -h172.30.xx.xx -P2883 -uroot@mq_t1#cluster -p**** -A
    ```

2. 查询租户的 Global 变量。

    ```sql
    obclient [(none)]> SHOW GLOBAL VARIABLES WHERE variable_name LIKE  'ob_query_timeout';
    ```

    查询结果如下：

    ```shell
    +------------------+----------+
    | Variable_name    | Value    |
    +------------------+----------+
    | ob_query_timeout | 10000000 |
    +------------------+----------+
    1 row in set
    ```

3. 通过 `SET` 修改 Global 级别变量值。

    :::tab
    tab MySQL 模式

    MySQL 模式支持通过以下方式修改 Global 级别变量：

    ```shell
    obclient [oceanbase]> SET GLOBAL ob_query_timeout = 20000000;
    ```

    或者

    ```shell
    obclient [oceanbase]> SET GLOBAL ob_query_timeout := 20000000;
    ```    

    tab Oracle 模式

    Oracle 模式支持通过以下方式修改 Global 级别变量：

    ```shell
    obclient [SYS]> SET GLOBAL ob_query_timeout = 20000000;
    ```

    或者

    ```shell
    obclient [SYS]> ALTER SYSTEM SET ob_query_timeout = 20000000;
    ```

    :::

4. 查看修改结果。

    ```shell
    obclient [(none)]> SHOW GLOBAL VARIABLES WHERE variable_name LIKE 'ob_query_timeout';
    +------------------+----------+
    | Variable_name    | Value    |
    +------------------+----------+
    | ob_query_timeout | 20000000 |
    +------------------+----------+
    1 row in set
    ```

    修改成功后，还可以通过视图 `DBA_OB_SYS_VARIABLES` 查询 `ob_query_timeout` 变量值的详细修改情况及默认值，语句如下。

    
    ```sql
    obclient [oceanbase]> SELECT * FROM oceanbase.DBA_OB_SYS_VARIABLES WHERE NAME='ob_query_timeout';
    ```

    查询结果如下：

    ```shell
    +----------------------------+----------------------------+------------------+----------+-----------+-----------+------------------+----------------------------------+---------------+-----------+
    | CREATE_TIME                | MODIFY_TIME                | NAME             | VALUE    | MIN_VALUE | MAX_VALUE | SCOPE            | INFO                             | DEFAULT_VALUE | ISDEFAULT |
    +----------------------------+----------------------------+------------------+----------+-----------+-----------+------------------+----------------------------------+---------------+-----------+
    | 2023-12-08 14:00:20.583506 | 2023-12-12 11:51:46.237099 | ob_query_timeout | 20000000 |           |           | GLOBAL | SESSION | Query timeout in microsecond(us) | 10000000      | NO        |
    +----------------------------+----------------------------+------------------+----------+-----------+-----------+------------------+----------------------------------+---------------+-----------+
    1 row in set
    ```

## 修改布尔类型变量

在 `SHOW VARIABLES` 命令中显示 ON/OFF 的变量，可以通过如下任意方法设置变量值：

```sql
SET foreign_key_checks = ON;
SET foreign_key_checks = TRUE;
SET foreign_key_checks = 1;

SET GLOBAL foreign_key_checks = OFF;
SET GLOBAL foreign_key_checks = FALSE;
SET GLOBAL foreign_key_checks = 0;
```

<main id="notice" type='explain'>
 <h4>说明</h4>
 <p>通过 ON/OFF、TRUE/FALSE 或 1/0 三种方式进行布尔类型变量的设置是等效的。</p>
</main>

## 相关文档

关于系统变量的更多信息，参见：

* [配置项和系统变量概述](../../../700.reference/800.configuration-items-and-system-variables/000.configuration-items-and-system-variables-overview.md)
* [查看系统变量](../600.common-tenant-operations/600.view-system-variables-of-tenant.md)
