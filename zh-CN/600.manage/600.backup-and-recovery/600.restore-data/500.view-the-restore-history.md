# 查看恢复结果

恢复结束后，可以通过视图查看恢复结果。

## 查看物理恢复结果

1. 使用 `root` 用户登录集群的 `sys` 租户。

2. 待恢复完成后，您可以执行以下语句，查看集群的恢复任务结果。

   ```sql
   obclient [(none)]> SELECT * FROM oceanbase.CDB_OB_RESTORE_HISTORY\G
   ```

   查看结果示例如下：

   ```shell
   *************************** 1. row ***************************
                       TENANT_ID: 1
                          JOB_ID: 1
             RESTORE_TENANT_NAME: mysql
               RESTORE_TENANT_ID: 1002
              BACKUP_TENANT_NAME: backup_tenant
                BACKUP_TENANT_ID: 1002
             BACKUP_CLUSTER_NAME: backup_cluster
                     BACKUP_DEST: file:///data/nfs/backup//archive,file:///data/nfs/backup/data
                     RESTORE_SCN: 1658389117092435000
             RESTORE_SCN_DISPLAY: 2022-06-1 07:38:37.092435
                  RESTORE_OPTION: pool_list=small_pool_2&primary_zone=z1
                 START_TIMESTAMP: 2022-06-1 15:40:58.366601
                FINISH_TIMESTAMP: 2022-06-1 15:44:16.061358
                          STATUS: SUCCESS
               BACKUP_PIECE_LIST: file:///data/nfs/backup/archive/2_1_2,file:///data/nfs/backup/archive/2_1_3
                 BACKUP_SET_LIST: file:///data/nfs/backup/data/backup_set_1_full
          BACKUP_CLUSTER_VERSION: 17179869184
                        LS_COUNT: 3
                 FINISH_LS_COUNT: 3
                    TABLET_COUNT: 428
             FINISH_TABLET_COUNT: 428
                     TOTAL_BYTES: 313158553
             TOTAL_BYTES_DISPLAY: 298.65MB
                    FINISH_BYTES: 0
            FINISH_BYTES_DISPLAY: 0.00MB
                     DESCRIPTION: NULL
                         COMMENT: NULL
   *************************** 2. row ***************************
                       TENANT_ID: 1002
                          JOB_ID: 1
             RESTORE_TENANT_NAME: mysql
               RESTORE_TENANT_ID: 1002
              BACKUP_TENANT_NAME: backup_tenant
                BACKUP_TENANT_ID: 1002
             BACKUP_CLUSTER_NAME: backup_cluster
                     BACKUP_DEST: file:///data/nfs/backup//archive,file:///data/nfs/backup/data
                     RESTORE_SCN: 1658389117092435000
             RESTORE_SCN_DISPLAY: 2022-06-1 07:38:37.092435
                  RESTORE_OPTION: pool_list=small_pool_2&primary_zone=z1
                 START_TIMESTAMP: 2022-06-1 15:40:58.366601
                FINISH_TIMESTAMP: 2022-06-1 15:44:05.304540
                          STATUS: SUCCESS
               BACKUP_PIECE_LIST: file:///data/nfs/backup/archive/2_1_2,file:///data/nfs/backup/archive/2_1_3
                 BACKUP_SET_LIST: file:///data/nfs/backup/data/backup_set_1_full
          BACKUP_CLUSTER_VERSION: 17179869184
                        LS_COUNT: 3
                 FINISH_LS_COUNT: 3
                    TABLET_COUNT: 428
             FINISH_TABLET_COUNT: 428
                     TOTAL_BYTES: 313158553
             TOTAL_BYTES_DISPLAY: 298.65MB
                    FINISH_BYTES: 0
            FINISH_BYTES_DISPLAY: 0.00MB
                     DESCRIPTION: NULL
                         COMMENT: NULL
   1 row in set
   ```

    `CDB_OB_RESTORE_HISTORY` 视图中各字段基本与 `CDB_OB_RESTORE_PROGRESS` 相对应。其中， `COMMENT` 用于记录任务失败时的相关错误信息。

    如果恢复失败，您可以通过删除租户的方式来取消本次恢复，具体操作请参见 [取消恢复](../600.restore-data/300.cancel-a-restore.md)。

### 后续操作

物理恢复执行成功后，恢复后的租户均为备租户，您可执行如下操作:

* 执行 `recover` 命令, 作为备租户继续日志归档从源租户回放日志, 具体操作参见 [备租户日志回放](../600.restore-data/700.recover-the-standby-tenant.md)。

* 执行备切主命令，将备租户转换为主租户，具体操作参见 [备租户转为主租户](../600.restore-data/600.active-standby-tenant.md)。

## 查看指定表的恢复结果

表的恢复过程主要包含以下两个任务：恢复任务和导入任务。恢复任务负责从备份数据中将指定时间点的数据恢复到辅助租户中；导入任务负责将指定的表从辅助租户跨租户导入到目标租户中。您可以分别查看两个任务的历史详细信息。

1. 使用 `root` 用户登录表待恢复的目标租户所在集群的 `sys` 租户。

2. 执行以下命令，查看表恢复的结果。

   * 查看表的恢复任务的历史信息

      ```sql
      obclient [(none)]> SELECT * FROM oceanbase.CDB_OB_RECOVER_TABLE_JOB_HISTORY\G
      ```

      查询结果的示例如下：

      ```shell
      *************************** 1. row ***************************
                  TENANT_ID: 1
                     JOB_ID: 1
        INITIATOR_TENANT_ID: 1
           INITIATOR_JOB_ID: 0
            START_TIMESTAMP: 2023-06-01 06:00:00.000000
                     STATUS: COMPLETED
            AUX_TENANT_NAME: AUX_RECOVER$1692106995896258
         TARGET_TENANT_NAME: backup_tenant
                 IMPORT_ALL: 0
                    DB_LIST: `DB`
                 TABLE_LIST: `TEST`.`T1`
                RESTORE_SCN: 1692104831498747191
        RESTORE_SCN_DISPLAY: 2023-06-01 00:00:00.000000
             RESTORE_OPTION: pool_list=small_pool_0&primary_zone=z1
                BACKUP_DEST: file:///data2/nfs/ob_backup_oracle_tenant/archive,file:///data2/nfs/ob_backup_oracle_tenant/data
            BACKUP_SET_LIST: file:///data2/nfs/ob_backup_oracle_tenant/data/backup_set_1_full
          BACKUP_PIECE_LIST: file:///data2/nfs/ob_backup_oracle_tenant/archive/piece_d1001r1p1
              BACKUP_PASSWD: NULL
          EXTERNAL_KMS_INFO: NULL
              REMAP_DB_LIST: 
           REMAP_TABLE_LIST: `TEST`.`T1`:`RECOVER_TEST`.`T3`
      REMAP_TABLEGROUP_LIST:
      REMAP_TABLESPACE_LIST:
                     RESULT: 
                    COMMENT: 
      1 row in set
      ```   

   * 查看跨租户导入任务的历史信息

      ```sql
      obclient [(none)]> SELECT * FROM oceanbase.CDB_OB_IMPORT_TABLE_JOB_HISTORY\G
      ```

      查询结果的示例如下：

      ```shell
      *************************** 1. row ***************************
                  TENANT_ID: 1010
                     JOB_ID: 3
        INITIATOR_TENANT_ID: 1010
           INITIATOR_JOB_ID: 2
            START_TIMESTAMP: 2023-08-16 17:59:28.689435
            SRC_TENANT_NAME: AUX_RECOVER$1692179849034890
              SRC_TENANT_ID: 1014
                     STATUS: IMPORTING
                 IMPORT_ALL: 0
                    DB_LIST:
                 TABLE_LIST: `TEST`.`T1`
              REMAP_DB_LIST:
           REMAP_TABLE_LIST: `TEST`.`T1`:`RECOVER_TEST`.`T3`
      REMAP_TABLEGROUP_LIST:
      REMAP_TABLESPACE_LIST:
          TOTAL_TABLE_COUNT: 0
       FINISHED_TABLE_COUNT: 0
         FAILED_TABLE_COUNT: 0
                     RESULT:
                    COMMENT:
      1 row in set
      ```

   * 查看跨租户导入任务中表的历史信息

      ```sql
      obclient [(none)]> SELECT * FROM oceanbase.CDB_OB_IMPORT_TABLE_TASK_HISTORY\G
      ```

      查询结果的示例如下：

      ```shell
      *************************** 1. row ***************************
                          TENANT_ID: 1002
                            TASK_ID: 1047
                             JOB_ID: 3
                      SRC_TENANT_ID: 1004
                     SRC_TABLESPACE: NULL
                     SRC_TABLEGROUP: NULL
                       SRC_DATABASE: test
                          SRC_TABLE: t1
                      SRC_PARTITION: NULL
                  TARGET_TABLESPACE: NULL
                  TARGET_TABLEGROUP: NULL
                    TARGET_DATABASE: recover_test
                       TARGET_TABLE: t3
                       TABLE_COLUMN: 7
                             STATUS: FINISH
                    START_TIMESTAMP: 2023-08-16 21:08:49.492389
               COMPLETION_TIMESTAMP: 2023-08-16 21:09:09.624866
                      CUMULATIVE_TS: -1
                  TOTAL_INDEX_COUNT: 2
               IMPORTED_INDEX_COUNT: 2
                 FAILED_INDEX_COUNT: 0
             TOTAL_CONSTRAINT_COUNT: 1
          IMPORTED_CONSTRAINT_COUNT: 1
            FAILED_CONSTRAINT_COUNT: 0
         TOTAL_REF_CONSTRAINT_COUNT: 1
      IMPORTED_REF_CONSTRAINT_COUNT: 0
        FAILED_REF_CONSTRAINT_COUNT: 1
                             RESULT: SUCCEESS
                            COMMENT:
      1 row in set
      ```

      有关 `CDB_OB_RECOVER_TABLE_JOB_HISTORY`、`CDB_OB_IMPORT_TABLE_JOB_HISTORY`、`CDB_OB_IMPORT_TABLE_TASK_HISTORY` 等视图中字段的详细说明，请参见 [物理恢复相关视图介绍](900.views-of-the-restore.md)。