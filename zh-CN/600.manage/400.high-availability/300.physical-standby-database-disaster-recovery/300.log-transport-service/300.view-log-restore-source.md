|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type||

# 查看日志恢复源信息

 `CDB_OB_LOG_RESTORE_SOURCE` 视图和 `DBA_OB_LOG_RESTORE_SOURCE` 视图中记录了日志恢复源信息，您可以通过查询视图来获取日志恢复源信息。

## 操作步骤

1. 使用管理员用户登录备租户或备租户所在集群的 `sys` 租户。

2. 执行以下命令，查看日志恢复源信息。

   * 系统租户（`sys` 租户）下查看日志恢复源信息

     ```sql
     SELECT * FROM oceanbase.CDB_OB_LOG_RESTORE_SOURCE;
     ```

   * 用户租户下查看日志恢复源信息

     * MySQL 模式：

       ```sql
       SELECT * FROM oceanbase.DBA_OB_LOG_RESTORE_SOURCE;
       ```

     * Oracle 模式：

       ```sql
       SELECT * FROM SYS.DBA_OB_LOG_RESTORE_SOURCE;
       ```

   基于日志归档的物理备库中，备租户的日志恢复源查询结果的示例如下：

   ```shell
   +-----------+----+----------+--------------------------------+---------------------+
   | TENANT_ID | ID | TYPE     | VALUE                          | RECOVERY_UNTIL_SCN  |
   +-----------+----+----------+--------------------------------+---------------------+
   |      1006 |  1 | LOCATION | file:///data/1/sh_archive      | 4611686018427387903 |
   +-----------+----+----------+--------------------------------+---------------------+
   1 row in set
   ```

   从查询结果可知，`TYPE` 列为 `LOCATION`，表示备租户是通过主租户或源端的备租户的日志归档来同步日志。

   基于网络的物理备库中，备租户的日志恢复源查询结果的示例如下：

   ```shell
   +-----------+----+---------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------+
   | TENANT_ID | ID | TYPE    | VALUE                                                                                                                                                                                                                             | RECOVERY_UNTIL_SCN  |
   +-----------+----+---------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------+
   |      1006 |  1 | SERVICE | IP_LIST=xx.xx.xx.22:17855;xx.xx.xx.23:17857;xx.xx.xx.24:17859,USER=rep_user@mysql,PASSWORD=***********************************,TENANT_ID=1004,CLUSTER_ID=1,COMPATIBILITY_MODE=MYSQL,IS_ENCRYPTED=true                             | 4611686018427387903 |
   +-----------+----+---------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------+
   1 row in set
   ```

   从查询结果可知，`TYPE` 列为 `SERVICE`，表示备租户是通过网络连接主租户或源端的备租户来同步日志。

3. 执行以下命令，查看日志链路相关信息。

   * 系统租户（`sys` 租户）下查看日志链路相关信息

     ```sql
     SELECT * FROM oceanbase.GV$OB_LOG_TRANSPORT_DEST_STAT;
     ```

   * 用户租户下查看日志链路相关信息。

     * MySQL 模式：

       ```sql
       SELECT * FROM oceanbase.GV$OB_LOG_TRANSPORT_DEST_STAT;
       ```

     * Oracle 模式：

       ```sql
       SELECT * FROM SYS.GV$OB_LOG_TRANSPORT_DEST_STAT;
       ```

## 相关文档

[设置日志恢复源](200.configure-the-log-transport-service/100.set-log-restore-source.md)
