|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type||

# 查看后台的分区均衡任务

触发分区均衡任务后，可通过视图查看相关任务的执行情况。

## 系统租户查看后台的分区均衡任务

1. 使用 `root` 用户登录集群的 sys 租户。

   连接示例如下，连接数据库时请以实际环境为准。

   ```shell
   obclient -h10.xx.xx.xx -P2883 -uroot@sys#obdemo -p***** -A
   ```

2. 执行以下语句，查看指定租户后台正在执行的分区均衡任务。

   * 查看指定租户正在执行的分区均衡任务。

     视图 `CDB_OB_BALANCE_JOBS` 展示了所有租户当前正在执行的宏观层面的均衡任务，包括扩容、缩容、迁移均衡、分区均衡等任务。

     ```shell
     obclient [oceanbase]> SELECT * FROM oceanbase.CDB_OB_BALANCE_JOBS WHERE TENANT_ID = 1002 AND JOB_TYPE = 'PARTITION_BALANCE';
     ```

     查询结果如下：

     ```shell
     +-----------+--------+----------------------------+----------------------------+---------------------------------+-------------------+-----------------+-------------------------+--------+---------+--------------+
     | TENANT_ID | JOB_ID | CREATE_TIME                | MODIFY_TIME                | BALANCE_STRATEGY                | JOB_TYPE          | TARGET_UNIT_NUM | TARGET_PRIMARY_ZONE_NUM | STATUS | COMMENT | MAX_END_TIME |
     +-----------+--------+----------------------------+----------------------------+---------------------------------+-------------------+-----------------+-------------------------+--------+---------+--------------+
     |      1002 | 374412 | 2024-06-14 14:39:38.710194 | 2024-06-14 14:39:38.710194 | partition attribution alignment | PARTITION_BALANCE |               1 |                       1 | DOING  | NULL    | NULL         |
     +-----------+--------+----------------------------+----------------------------+---------------------------------+-------------------+-----------------+-------------------------+--------+---------+--------------+
     1 row in set
     ```

     有关视图 `CDB_OB_BALANCE_JOBS` 中各字段的详细说明，参见 [CDB_OB_BALANCE_JOBS](../../../../700.reference/700.system-views/300.system-view-of-sys-tenant/200.dictionary-view-of-sys-tenant/7400.o-cdb_ob_balance_jobs-of-sys-tenant.md)。

   * 查看指定租户正在执行的 LS 级别的分区均衡任务。

     视图 `CDB_OB_BALANCE_TASKS` 展示了所有租户当前正在执行的日志流级别的任务，包括 LS 分裂（LS_SPLIT）、 LS 合并（LS_MERGE）、LS Transfer（LS_TRANSFER、）修改 LS 属性（LS_ALTER）等任务。 

     ```shell
     obclient [oceanbase]> SELECT * FROM oceanbase.CDB_OB_BALANCE_TASKS WHERE TENANT_ID = 1002 AND BALANCE_STRATEGY LIKE '%partition%';
     ```

     查询结果如下：

     ```shell
     +-----------+---------+----------------------------+----------------------------+-------------+--------+---------+---------------------------------------------------------------------------------------------------+--------------------+------------+---------------------+-------------+----------+-------------+------------+--------------------------+--------+---------+---------------------------------+
     | TENANT_ID | TASK_ID | CREATE_TIME                | MODIFY_TIME                | TASK_TYPE   | SRC_LS | DEST_LS | PART_LIST                                                                                         | FINISHED_PART_LIST | PART_COUNT | FINISHED_PART_COUNT | LS_GROUP_ID | STATUS   | PARENT_LIST | CHILD_LIST | CURRENT_TRANSFER_TASK_ID | JOB_ID | COMMENT | BALANCE_STRATEGY                |
     +-----------+---------+----------------------------+----------------------------+-------------+--------+---------+---------------------------------------------------------------------------------------------------+--------------------+------------+---------------------+-------------+----------+-------------+------------+--------------------------+--------+---------+---------------------------------+
     |      1002 |  374414 | 2024-06-14 14:39:38.710194 | 2024-06-14 14:39:42.356430 | LS_TRANSFER |   1002 |    1001 | 500224:500224,500229:500229,500234:500234,500239:500239,500244:500244,500249:500249,500254:500254 | NULL               |          7 |                   0 |        1001 | TRANSFER |             | 374415     |                        3 | 374412 |         | partition attribution alignment |
     |      1002 |  374415 | 2024-06-14 14:39:38.710194 | 2024-06-14 14:39:38.710194 | LS_ALTER    |   1002 |      -1 | NULL                                                                                              | NULL               |          0 |                   0 |           0 | INIT     | 374414      | NULL       |                       -1 | 374412 | NULL    | partition attribution alignment |
     +-----------+---------+----------------------------+----------------------------+-------------+--------+---------+---------------------------------------------------------------------------------------------------+--------------------+------------+---------------------+-------------+----------+-------------+------------+--------------------------+--------+---------+---------------------------------+
     2 rows in set
     ```

     有关视图 `CDB_OB_BALANCE_TASKS` 中各字段的详细说明，参见 [CDB_OB_BALANCE_TASKS](../../../../700.reference/700.system-views/300.system-view-of-sys-tenant/200.dictionary-view-of-sys-tenant/7600.o-cdb_ob_balance_tasks-of-sys-tenant.md)。

   * 查看指定租户正在执行的 Tablet 级别的分区均衡任务。

     视图 `CDB_OB_TRANSFER_TASK_HISTORY` 展示了所有租户当前正在执行的 Tablet 级别的任务，即展示具体对租户的哪些分区和 Tablet 进行 Transfer 操作。

     ```shell
     obclient [oceanbase]> SELECT * FROM oceanbase.CDB_OB_TRANSFER_TASKS WHERE TENANT_ID = 1002\G
     ```

     查询结果如下：

     ```shell
     *************************** 1. row ***************************
                    TENANT_ID:1002
                      TASK_ID: 3
                  CREATE_TIME: 2024-06-14 14:39:42.356430
                  MODIFY_TIME: 2024-06-14 14:38:44.315350
                       SRC_LS: 1002
                      DEST_LS: 1001
                    PART_LIST: 500224:500224,500229:500229,500234:500234,500239:500239,500244:500244,500249:500249,500254:500254
                   PART_COUNT: 7
          NOT_EXIST_PART_LIST: NULL
      LOCK_CONFLICT_PART_LIST: NULL
       TABLE_LOCK_TABLET_LIST: NULL
                  TABLET_LIST: 200089:0,200090:0,200091:0,200092:0,200093:0,200094:0,200095:0,1152921504606847076:0,1152921504606847077:0,1152921504606847078:0,1152921504606847079:0,1152921504606847080:0,1152921504606847081:0,1152921504606847082:0,1152921504606847083:0,1152921504606847084:0,1152921504606847085:0,1152921504606847086:0,1152921504606847087:0,1152921504606847088:0,1152921504606847089:0,1152921504606847090:0,1152921504606847091:0,1152921504606847092:0,1152921504606847093:0,1152921504606847094:0,1152921504606847095:0,1152921504606847096:0,1152921504606847097:0,1152921504606847098:0,1152921504606847099:0,1152921504606847100:0,1152921504606847101:0,1152921504606847102:0,1152921504606847103:0
                 TABLET_COUNT: 35
                    START_SCN: 1718347182784953001
                   FINISH_SCN: 0
                       STATUS: DOING
                     TRACE_ID: YB42AC1E87DC-00061AC2E77146D7-0-0
                       RESULT: 0
              BALANCE_TASK_ID: 374414
          TABLE_LOCK_OWNER_ID: 374434
                      COMMENT:
     1 row in set
     ```

     有关视图 `CDB_OB_TRANSFER_TASKS` 中各字段的详细说明，参见 [CDB_OB_TRANSFER_TASKS](../../../../700.reference/700.system-views/300.system-view-of-sys-tenant/200.dictionary-view-of-sys-tenant/11600.o-cdb_ob_transfer_tasks-of-sys-tenant.md)。

## 用户租户查看后台的分区均衡任务

1. 用户租户的租户管理员登录集群的 MySQL 租户或 Oracle 租户。

   连接示例如下，连接数据库时请以实际环境为准。

   ```shell
   obclient -h10.xx.xx.xx -P2883 -uroot@mysql_tenant#obdemo -p***** -A
   ```

2. 执行以下语句，查看本租户后台正在执行的分区均衡任务。

   :::tab
   tab MySQL 模式

   * 查看指定租户正在执行的分区均衡任务。

     视图 `DBA_OB_BALANCE_JOBS` 展示了当前租户正在执行的宏观层面的均衡任务，包括扩容、缩容、迁移均衡、分区均衡等任务。

     ```shell
     obclient [oceanbase]> SELECT * FROM oceanbase.DBA_OB_BALANCE_JOBS WHERE JOB_TYPE = 'PARTITION_BALANCE';
     ```

     查询结果如下：

     ```shell
     +--------+----------------------------+----------------------------+---------------------------------+-------------------+-----------------+-------------------------+--------+---------+--------------+
     | JOB_ID | CREATE_TIME                | MODIFY_TIME                | BALANCE_STRATEGY                | JOB_TYPE          | TARGET_UNIT_NUM | TARGET_PRIMARY_ZONE_NUM | STATUS | COMMENT | MAX_END_TIME |
     +--------+----------------------------+----------------------------+---------------------------------+-------------------+-----------------+------------------------- +--------+---------+--------------+
     | 374412 | 2024-06-14 14:39:38.710194 | 2024-06-14 14:39:38.710194 | partition attribution alignment | PARTITION_BALANCE |               1 |                       1 | DOING  | NULL    | NULL         |
     +--------+----------------------------+----------------------------+---------------------------------+-------------------+-----------------+-------------------------+--------+---------+--------------+
     1 row in set
     ```

     有关视图 `DBA_OB_BALANCE_JOBS` 中各字段的详细说明，参见 [DBA_OB_BALANCE_JOBS](../../../../700.reference/700.system-views/400.system-view-of-mysql-mode/200.dictionary-view-of-mysql-mode/7500.o-dba_ob_balance_jobs-of-mysql-mode.md)。

   * 查看指定租户正在执行的 LS 级别的分区均衡任务。

     视图 `DBA_OB_BALANCE_TASKS` 展示了当前租户正在执行的日志流级别的任务，包括 LS 分裂（LS_SPLIT）、 LS 合并（LS_MERGE）、LS Transfer（LS_TRANSFER、）修改 LS 属性（LS_ALTER）等任务。 

     ```shell
     obclient [oceanbase]> SELECT * FROM oceanbase.DBA_OB_BALANCE_TASKS WHERE BALANCE_STRATEGY LIKE '%partition%';
     ```

     查询结果如下：

     ```shell
     +---------+----------------------------+----------------------------+-------------+--------+---------+---------------------------------------------------------------------------------------------------+--------------------+------------+---------------------+-------------+----------+-------------+------------+--------------------------+--------+---------+---------------------------------+
     | TASK_ID | CREATE_TIME                | MODIFY_TIME                | TASK_TYPE   | SRC_LS | DEST_LS | PART_LIST                                                                                         | FINISHED_PART_LIST | PART_COUNT | FINISHED_PART_COUNT | LS_GROUP_ID | STATUS   | PARENT_LIST | CHILD_LIST | CURRENT_TRANSFER_TASK_ID | JOB_ID | COMMENT | BALANCE_STRATEGY                |
     +---------+----------------------------+----------------------------+-------------+--------+---------+---------------------------------------------------------------------------------------------------+--------------------+------------+---------------------+-------------+----------+-------------+------------+--------------------------+--------+---------+---------------------------------+
     |  374414 | 2024-06-14 14:39:38.710194 | 2024-06-14 14:39:42.356430 | LS_TRANSFER |   1002 |    1001 | 500224:500224,500229:500229,500234:500234,500239:500239,500244:500244,500249:500249,500254:500254 | NULL               |          7 |                   0 |        1001 | TRANSFER |             | 374415     |                        3 | 374412 |         | partition attribution alignment |
     |  374415 | 2024-06-14 14:39:38.710194 | 2024-06-14 14:39:38.710194 | LS_ALTER    |   1002 |      -1 | NULL                                                                                              | NULL               |          0 |                   0 |           0 | INIT     | 374414      | NULL       |                       -1 | 374412 | NULL    | partition attribution alignment |
     +---------+----------------------------+----------------------------+-------------+--------+---------+---------------------------------------------------------------------------------------------------+--------------------+------------+---------------------+-------------+----------+-------------+------------+--------------------------+--------+---------+---------------------------------+
     2 rows in set
     ```

     有关视图 `DBA_OB_BALANCE_TASKS` 中各字段的详细说明，参见 [DBA_OB_BALANCE_TASKS](../../../../700.reference/700.system-views/400.system-view-of-mysql-mode/200.dictionary-view-of-mysql-mode/7700.o-dba_ob_balance_tasks-of-mysql-mode.md)。

   * 查看指定租户正在执行的 Tablet 级别的分区均衡任务。

     视图 `DBA_OB_TRANSFER_TASKS` 展示了当前租户正在执行的 Tablet 级别的任务，即展示具体对租户的哪些分区和 Tablet 进行 Transfer 操作。

     ```shell
     obclient [oceanbase]> SELECT * FROM oceanbase.DBA_OB_TRANSFER_TASKS\G
     ```

     查询结果如下：

     ```shell
     *************************** 1. row ***************************
                      TASK_ID: 3
                  CREATE_TIME: 2024-06-14 14:39:42.356430
                  MODIFY_TIME: 2024-06-14 14:38:44.315350
                       SRC_LS: 1002
                      DEST_LS: 1001
                    PART_LIST: 500224:500224,500229:500229,500234:500234,500239:500239,500244:500244,500249:500249,500254:500254
                   PART_COUNT: 7
          NOT_EXIST_PART_LIST: NULL
      LOCK_CONFLICT_PART_LIST: NULL
       TABLE_LOCK_TABLET_LIST: NULL
                  TABLET_LIST: 200089:0,200090:0,200091:0,200092:0,200093:0,200094:0,200095:0,1152921504606847076:0,1152921504606847077:0,1152921504606847078:0,1152921504606847079:0,1152921504606847080:0,1152921504606847081:0,1152921504606847082:0,1152921504606847083:0,1152921504606847084:0,1152921504606847085:0,1152921504606847086:0,1152921504606847087:0,1152921504606847088:0,1152921504606847089:0,1152921504606847090:0,1152921504606847091:0,1152921504606847092:0,1152921504606847093:0,1152921504606847094:0,1152921504606847095:0,1152921504606847096:0,1152921504606847097:0,1152921504606847098:0,1152921504606847099:0,1152921504606847100:0,1152921504606847101:0,1152921504606847102:0,1152921504606847103:0
                 TABLET_COUNT: 35
                    START_SCN: 1718347182784953001
                   FINISH_SCN: 0
                       STATUS: DOING
                     TRACE_ID: YB42AC1E87DC-00061AC2E77146D7-0-0
                       RESULT: 0
              BALANCE_TASK_ID: 374414
          TABLE_LOCK_OWNER_ID: 374434
                      COMMENT:
     1 row in set
     ```

     有关视图 `DBA_OB_TRANSFER_TASKS` 中各字段的详细说明，参见 [DBA_OB_TRANSFER_TASKS](../../../../700.reference/700.system-views/400.system-view-of-mysql-mode/200.dictionary-view-of-mysql-mode/12400.o-dba_ob_transfer_tasks-of-mysql-mode.md)。

   tab Oracle 模式

   * 查看指定租户正在执行的分区均衡任务。

     视图 `DBA_OB_BALANCE_JOBS` 展示了当前租户正在执行的宏观层面的均衡任务，包括扩容、缩容、迁移均衡、分区均衡等任务。

     ```shell
     obclient [SYS]> SELECT * FROM SYS.DBA_OB_BALANCE_JOBS WHERE JOB_TYPE = 'PARTITION_BALANCE';
     ```

     查询结果如下：

     ```shell
     +--------+------------------------------+------------------------------+---------------------------------+-------------------+-----------------+-------------------------+--------+---------+--------------+
     | JOB_ID | CREATE_TIME                  | MODIFY_TIME                  | BALANCE_STRATEGY                | JOB_TYPE          | TARGET_UNIT_NUM | TARGET_PRIMARY_ZONE_NUM | STATUS | COMMENT | MAX_END_TIME |
     +--------+------------------------------+------------------------------+---------------------------------+-------------------+-----------------+-------------------------+--------+---------+--------------+
     | 370858 | 14-JUN-24 02.22.54.870414 PM | 14-JUN-24 02.22.54.870414 PM | partition attribution alignment | PARTITION_BALANCE |               1 |                       1 | DOING  | NULL    | NULL         |
     +--------+------------------------------+------------------------------+---------------------------------+-------------------+-----------------+-------------------------+--------+---------+--------------+
     1 row in set
     ```

     有关视图 `DBA_OB_BALANCE_JOBS` 中各字段的详细说明，参见 [DBA_OB_BALANCE_JOBS](../../../../700.reference/700.system-views/500.system-view-of-oracle-mode/200.dictionary-view-of-oracle-mode/11100.dba_ob_balance_jobs-of-oracle-mode.md)。

   * 查看指定租户正在执行的 LS 级别的分区均衡任务。

     视图 `DBA_OB_BALANCE_TASKS` 展示了当前租户正在执行的日志流级别的任务，包括 LS 分裂（LS_SPLIT）、 LS 合并（LS_MERGE）、LS Transfer（LS_TRANSFER、）修改 LS 属性（LS_ALTER）等任务。 

     ```shell
     obclient [sys]> SELECT * FROM SYS.DBA_OB_BALANCE_TASKS WHERE BALANCE_STRATEGY LIKE '%partition%';
     ```

     查询结果如下：

     ```shell
     +---------+------------------------------+------------------------------+-------------+--------+---------+-----------------------------------------------------------------------+--------------------+------------+---------------------+-------------+----------+-------------+------------+--------------------------+--------+---------+---------------------------------+
     | TASK_ID | CREATE_TIME                  | MODIFY_TIME                  | TASK_TYPE   | SRC_LS | DEST_LS | PART_LIST                                                             | FINISHED_PART_LIST | PART_COUNT | FINISHED_PART_COUNT | LS_GROUP_ID | STATUS   | PARENT_LIST | CHILD_LIST | CURRENT_TRANSFER_TASK_ID | JOB_ID | COMMENT | BALANCE_STRATEGY                |
     +---------+------------------------------+------------------------------+-------------+--------+---------+-----------------------------------------------------------------------+--------------------+------------+---------------------+-------------+----------+-------------+------------+--------------------------+--------+---------+---------------------------------+
     |  370859 | 14-JUN-24 02.22.54.870414 PM | 14-JUN-24 02.22.55.737260 PM | LS_ALTER    |   1002 |      -1 | NULL                                                                  | NULL               |          0 |                   0 |        1001 | ALTER_LS | NULL        | 370860     |                       -1 | 370858 | NULL    | partition attribution alignment |
     |  370860 | 14-JUN-24 02.22.54.870414 PM | 14-JUN-24 02.22.54.870414 PM | LS_TRANSFER |   1002 |    1001 | 500048:500048,500051:500051,500054:500054,500057:500057,500060:500060 | NULL               |          5 |                   0 |        1001 | INIT     | 370859      | 370861     |                       -1 | 370858 | NULL    | partition attribution alignment |
     |  370861 | 14-JUN-24 02.22.54.870414 PM | 14-JUN-24 02.22.54.870414 PM | LS_ALTER    |   1002 |      -1 | NULL                                                                  | NULL               |          0 |                   0 |           0 | INIT     | 370860      | NULL       |                       -1 | 370858 | NULL    | partition attribution alignment |
     +---------+------------------------------+------------------------------+-------------+--------+---------+-----------------------------------------------------------------------+--------------------+------------+---------------------+-------------+----------+-------------+------------+--------------------------+--------+---------+---------------------------------+
     3 rows in set
     ```

     有关视图 `DBA_OB_BALANCE_TASKS` 中各字段的详细说明，参见 [DBA_OB_BALANCE_TASKS](../../../../700.reference/700.system-views/500.system-view-of-oracle-mode/200.dictionary-view-of-oracle-mode/11300.dba_ob_balance_tasks-of-oracle-mode.md)。

   * 查看指定租户正在执行的 Tablet 级别的分区均衡任务。

     视图 `DBA_OB_TRANSFER_TASKS` 展示了当前租户正在执行的 Tablet 级别的任务，即展示具体对租户的哪些分区和 Tablet 进行 Transfer 操作。

     ```shell
     obclient [SYS]> SELECT * FROM SYS.DBA_OB_TRANSFER_TASKS\G
     ```

     查询结果如下：

     ```shell
     *************************** 1. row ***************************
                      TASK_ID: 2
                  CREATE_TIME: 14-JUN-24 02.22.58.755501 PM
                  MODIFY_TIME: 14-JUN-24 02.22.59.267311 PM
                       SRC_LS: 1002
                      DEST_LS: 1001
                    PART_LIST: 500048:500048,500051:500051,500054:500054,500057:500057,500060:500060
                   PART_COUNT: 5
          NOT_EXIST_PART_LIST: NULL
      LOCK_CONFLICT_PART_LIST: NULL
       TABLE_LOCK_TABLET_LIST: NULL
                  TABLET_LIST: 200015:0,200016:0,200017:0,200018:0,200019:0,1152921504606847003:0,1152921504606847004:0,1152921504606847005:0,1152921504606847006:0,1152921504606847007:0,1152921504606847008:0,1152921504606847009:0,1152921504606847010:0,1152921504606847011:0,1152921504606847012:0
                 TABLET_COUNT: 15
                    START_SCN: 1718346179101597002
                   FINISH_SCN: 0
                       STATUS: DOING
                     TRACE_ID: YB42AC1E87DC-00061AC2EE11426E-0-0
                       RESULT: 0
              BALANCE_TASK_ID: 370860
          TABLE_LOCK_OWNER_ID: 370880
                      COMMENT: NULL
     1 row in set
     ```

     有关视图 `DBA_OB_TRANSFER_TASKS` 中各字段的详细说明，参见 [DBA_OB_TRANSFER_TASKS](../../../../700.reference/700.system-views/500.system-view-of-oracle-mode/200.dictionary-view-of-oracle-mode/15800.dba_ob_transfer_tasks-of-oracle-mode.md)。

   :::

## 相关文档

[查看后台的分区均衡任务历史](600.view-background-partition-balance-task-history.md)