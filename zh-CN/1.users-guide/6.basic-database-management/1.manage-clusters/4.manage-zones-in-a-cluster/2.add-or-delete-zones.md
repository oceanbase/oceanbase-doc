# 增加或删除 Zone

您可以通过 SQL 语句或 OCP 来增加或删除 Zone。

在集群中增加或删除 Zone 的操作通常用于集群扩容或缩容等需求场景。

## 通过 SQL 语句增加或删除 Zone

增加或删除 Zone 的 SQL 语句如下：

```sql
ALTER SYSTEM {ADD|DELETE} ZONE zone_name;
```

使用说明：

* 该语句仅支持在 `sys` 租户中执行。

* 参数 `zone_name` 为目标 Zone 的名称，每条语句每次仅支持添加或删除一个 Zone。

* 通过 `ALTER SYSTEM ADD ZONE zone_name;` 语句增加 Zone 后，如果需要进一步在集群中使用该 Zone，还需要在 Zone 上添加 OBServer，分配资源，并增加副本信息。

  通过增加 Zone 来完成集群扩容的相关操作请参见 [在集群中增加 Zone](../../../11.operation-and-maintenance-management/2.scale-out-and-scale-in/2.cluster-level-scale-out-and-scale-in/1.scale-out/1.add-zones-in-a-cluster.md)。
  
* 在删除 Zone 前，需要保证该 Zone 下已不存在 OBServer，否则将会导致删除失败。

示例：

* 在集群中新增一个名为 `zone1`的 Zone。

  ```sql
  obclient> ALTER SYSTEM ADD ZONE zone1;
  ```

* 在集群中删除名为 `zone1` 的 Zone。

  ```sql
  obclient> ALTER SYSTEM DELETE ZONE zone1;
  ```

## 通过 OCP 增加 Zone

在集群中，根据实际部署模式增加 Zone。

### 前提条件

* 待操作的集群可以在当前 OCP 中进行管理。

  如果该集群未加入到 OCP 中进行管理，请联系管理员将待操作的集群接管到当前 OCP 中，具体操作方法请参见 OCP 对应版本的《用户指南》文档中的 **接管集群** 。
  
* 在增加 zone 前，请确认当前登录用户已具备集群的管理权限。

  如果当前用户没有集群管理的权限，请联系管理员为您添加相应权限的角色，具体操作方法请参见 OCP 对应版本的《用户指南》文档中的 **编辑用户** 。
  
### 操作步骤

1. 登录 OCP。

   默认进入 **集群概览** 页面。

2. 在该页面的 **集群列表** 区域，选择待操作的集群并单击其集群名。

3. 在 **总览** 页面右上角，单击 **新增 Zone** 。

4. 在弹出的对话框中，设置 Zone 信息。

   默认是添加一个 Zone 信息，如果您需要添加多个 Zone ，可以在下方单击 **新增** 按钮，添加个 Zone 信息。
   **说明**

   Zone 中的主机硬件架构需与集群的硬件架构保持一致。

   ![09161742](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/5060562361/p327385.png)

   需要设置的 Zone 信息如下表所示。

   | **配置**  |                                                               **描述**                                                               |
   |---------|------------------------------------------------------------------------------------------------------------------------------------|
   | Zone 名称 | 自定义 Zone 名称。                                                                                                                       |
   | 机房      | Zone 所在的机房。                                                                                                                        |
   | 机型      | 可选项。 如果选择了机型，后面主机列表会根据机型进行过滤。                                                                                      |
   | 机器选择方式  | 可以选择 **自动分配** 或者 **手动选择** 。                                                                                                        |
   | 主机      | 您可以选择多个 IP。 如果 **机器选择方式** 是 **自动分配** ，则只需要输入机器的数量，OCP 会自动选择相应数量的可用机器；如果 **机器选择方式** 是 **手动选择** ，则需要您手动从列表中选择若干个 IP。 |

5. 完成后，单击 **确定** 。

   您可通过弹出框中的 **查看任务** 按钮，查看新建进度。

   您也可在 **系统管理 \> 任务** 中查看该任务的进度。

   当该任务状态为 **完成** ，且集群 **总览** 页的 **Zone 列表** 中，该 Zone 的状态为 **运行中** 时，则新建成功。

## 通过 OCP 删除 Zone

在集群中，根据实际部署模式下线 Zone。
>**注意**
>
>相比停止和删除 Zone 命令，OCP 中提供的删除 Zone 功能是删除数据副本并下线 Zone 内所有 OceanBase 服务器节点操作的组合。

### 前提条件

* 在删除 zone 前，请确认当前登录用户具备集群的管理权限。如果当前用户没有集群管理的权限，请联系管理员为您添加相应权限的角色，具体操作方法请参见 OCP 对应版本的《用户指南》文档中的 **编辑用户** 。

* 在删除 Zone 前，需要保证该 Zone 下已不存在 OBServer，否则将会导致删除失败。

* 请确认待删除的 Zone 未承载租户的主副本，如果有承载主副本，请确认该租户有其他全功能型副本且可用，否则删除该 Zone 会导致业务停止且不可恢复。

### 操作步骤

1. 登录 OCP 。

   默认进入 **集群概览** 页面。

2. 在该页面的 **集群列表** 区域，选择待操作的集群并单击其集群名。

3. 在 **Zone 列表** 区域，单击 **操作** 列后的 **删除** 。

   ![11181759](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/2785987361/p355142.png)

   系统弹出确认删除的操作提示。

4. 在弹出框中单击 **删除** 。

   您可通过弹出框中的 **查看任务** 按钮，查看删除进度。

   您也可在 **系统管理 \> 任务** 中查看该任务的进度。

   当该任务状态为 **完成** ，且集群 **总览** 页的 **Zone 列表** 中无该 Zone 时，则删除成功。
