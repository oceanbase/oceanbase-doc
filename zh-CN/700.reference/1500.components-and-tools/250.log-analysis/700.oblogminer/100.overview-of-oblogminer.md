# oblogminer 概述

OceanBase LogMiner（简称 oblogminer）是一款用于对 OceanBase 数据库进行日志分析的命令行工具，支持在线以及归档日志分析。oblogminer 通过 obcdc 来拉取并解析 clog 日志，将 obcdc 输出的逻辑日志转化成易读的格式，并将分析结果存储到指定位置。

## 功能特点

1. 支持从在线日志或归档日志中读取并分析。

2. 支持将分析结果存储在本地/OSS。

3. 支持多种记录过滤条件。

4. 支持多种记录输出格式。

5. 支持生成 REDO/UNDO SQL。

6. 支持多种可选命令行参数。

## 使用场景

### 自助服务

oblogminer 支持对在线日志和归档日志的分析和处理，支持展示指定一段时间内的所有修改变更。一方面提供了故障时间点精准定位的能力，另一方面会降低排查问题的复杂度，提高诊断问题的效率。帮助用户具备强大和迅速定位问题的能力，达到自助服务的目的。

### 细粒度恢复

当用户在某个时刻对数据库进行误操作时，通过 oblogminer 可以生成逆向回滚 SQL（UNDO SQL），从而提供了“SQL 闪回”的细粒度恢复能力。

### 数据分析

oblogminer 支持获取所有的 DDL 和 DML 变更，同时保证按照执行顺序输出。oblogminer 会将 clog 日志中各种信息（事务、表结构等）组织并友好地展示出来，从而提高可观测性。

## 使用限制

1. 由于 oblogminer 基于 obcdc 实现，obcdc 的使用限制也是 oblogminer 的限制，如 obcdc 不兼容的 OceanBase 数据库版本，oblogminer 也不兼容。

2. 暂不支持输出被中止的事务，默认输出的都为 COMMIT 的事务。事务内数据聚合输出，即将单个事务内所有操作组合一起，不同的事务按照提交顺序输出。

3. 暂不支持输出 ROLLBACK TO SAVEPOINT 回滚的数据。

4. 暂不支持分析备库日志。

5. 暂不支持分析输出非事务数据、索引表数据。

6. 暂不支持指定文件分析，本身涉及到分布式事务组装（位于不同机器多个 Redo 文件中）、事务完整性（分析指定文件，事务数据不完整）等原因。

7. 不支持解析和输出临时表的数据，和 Oracle 的行为保持一致。

8. 不支持 DDL 语句过滤。

9. 对于含 lob 类型或不支持类型的记录，会在 REDO/UNDO SQL 中标记 `/* POTENTIALLY INACCURATE */`，表明 REDO/UNDO SQL 结果可能不正确。

10. 为保证事务完整性，可能会输出超过指定结束时间的事务。

11. 不支持旁路导入的数据。

12. 不支持在系统租户上使用。

13. 读取归档日志需保证归档日志连续，且持续打开日志归档功能。

14. 由于日志归档存在延迟，当从日志归档中分析最近 archive_lag_target 时间的日志时，分析速度会比较慢。

15. 通过 ODP 连接 OceanBase 数据库进行日志分析时，暂不支持使用 `user@tenant#cluster` 格式的用户名（`-u`/`--user-name` 指定）。

16. 暂不支持分析对象存储中的归档日志。
