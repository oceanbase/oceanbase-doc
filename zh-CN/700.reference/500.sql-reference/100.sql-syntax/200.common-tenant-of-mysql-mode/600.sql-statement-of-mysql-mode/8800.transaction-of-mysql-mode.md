| Description   |                 |
|---------------|-----------------|
| keywords      |                 |
| dir-name      |                 |
| dir-name-en   |                 |
| tenant-type   | MySQL Mode      |

# TRANSACTION

## 描述

该语句用于开启事务。

数据库事务（Database Transaction）是指作为单个逻辑工作单元执行的一系列操作。事务处理可以用来维护数据库的完整性，保证成批的 SQL 操作全部执行或全部不执行。

显示事务是用户自定义或用户指定的事务。通过 `BEGIN` 和 `BEGIN WORK`（被作为 `START TRANSACTION` 的别名）语句显示开始，以 `COMMIT` 或 `ROLLBACK` 语句显示结束。

## 语法

```sql
transaction_stmt:
      START TRANSACTION [READ ONLY | READ WRITE];
    | BEGIN [WORK];
    | COMMIT [WORK];
    | ROLLBACK [WORK];
    | SET TRANSACTION {READ ONLY | READ WRITE};
```

## 参数解释

|                    **参数**                     |                                                                                       **描述**                                                                                        |
|-----------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| START TRANSACTION \[READ ONLY \| READ WRITE\] | 开启事务语句。一旦开启事务，则随后的 SQL 数据操作语句（即 `INSERT` 、`UPDATE` 、`DELETE`等）直到显式提交时才会生效。 `READ ONLY` 表示事务是只读方式开启，事务内不允许执行修改操作。 `READ WRITE` 表示事务是读写方式开启，默认就是此种模式。 |
| BEGIN                                         | `BEGIN` 和 `BEGIN WORK` 被作为 `START TRANSACTION` 的别名。                                                                                                                                 |
| COMMIT                                        | 提交当前事务。                                                                                                                                                                             |
| ROLLBACK                                      | 回滚当前事务。                                                                                                                                                                             |
| SET TRANSACTION {READ ONLY \| READ WRITE}     | 将当前事务设置成 `READ ONLY` 或者 `READ WRITE` 模式。                                                                                                                                            |

## 示例

* 假设现有表 `a` 如下所示。

  | id | name | num |      sell_date      |
  |----|------|-----|---------------------|
  | 1  | a    | 100 | 2013-06-21 10:06:43 |
  | 2  | b    | 200 | 2013-06-21 13:07:21 |
  | 3  | a    | 50  | 2013-06-21 13:08:15 |

1. 依次执行以下命令开始执行事务，将 `id` 为 `3` 的 `name` 改为 `c`，并插入一行当前卖出 `a` 的记录。

   ```sql
   obclient> START TRANSACTION;
   Query OK, 0 rows affected

   obclient> UPDATE a SET name = 'c' WHERE id = 3;
   Query OK, 1 rows affected  

   obclient> INSERT INTO a VALUES (4, 'a', 30, '2013-06-21 16:09:13');
   Query OK, 1 rows affected  

   obclient> COMMIT;
   Query OK, 0 rows affected
   ```

2. 事务提交后，执行命令查看表 `a` 信息。

   ```sql
   SELECT * FROM a;
   ```

   结果如下：

   | id | name | num |      sell_date      |
   |----|------|-----|---------------------|
   | 1  | a    | 100 | 2013-06-21 10:06:43 |
   | 2  | b    | 200 | 2013-06-21 13:07:21 |
   | 3  | c    | 50  | 2013-06-21 13:08:15 |
   | 4  | a    | 30  | 2013-06-21 16:09:13 |

  <main id="notice" type='notice'>
    <h4>注意</h4>
    <ul>
    <li>在事务还没有 <code>COMMIT</code> 之前，您可以查看下本事务中的操作是否已经生效。例如，可以在 <code>COMMIT</code> 前执行 SQL 语句 <code>SELECT * FROM a;</code>。</li>
    <li>本事务 Session 的访问能读到最新的结果，本事务 Session 之外的访问结果肯定是没有生效，在事务还没有 <code>COMMIT</code> 前，之前做的操作除当前事务连接之外都是不可见的。</li>
    <li>如果想回滚该事务，直接用 <code>ROLLBACK</code> 代替 <code>COMMIT</code>。</li>
    </ul>
  </main>
