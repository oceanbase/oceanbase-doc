| Description   |                 |
|---------------|-----------------|
| keywords      |                 |
| dir-name      |                 |
| dir-name-en   |                 |
| tenant-type   | MySQL Mode      |

# 高效压缩位图数据类型转换

OceanBase 数据库支持将高效压缩位图类型的数据转换为其他数据类型，不支持将其他类型的数据转换为高效压缩位图类型。

 <main id="notice" type='explain'>
    <h4>说明</h4>
    <p>Oceanbase 返回可视化查询结果需了解的注意事项请见[创建高效压缩位图列](200.create-roaring-bitmap-columns-of-mysql-mode.md)。</p>
  </main>

## 转换为字符串类型

将高效压缩位图数据类型转换为字符串类型，示例如下：

```sql
-- 创建测试表
CREATE TABLE t1 (rb ROARINGBITMAP);

-- 插入测试数据
INSERT INTO t1 VALUES (rb_from_string('1,2,3'));
INSERT INTO t1 VALUES (rb_from_string('2,3,4'));
INSERT INTO t1 VALUES (x'0100');
```

查询表，返回结果如下：

```sql
SELECT * FROM t1;
+----------------------------------+
| rb                               |
+----------------------------------+
| 0x010303010000000200000003000000 |
| 0x010303020000000300000004000000 |
| 0x0100                           |
| 0x010303010000000200000003000000 |
+----------------------------------+
4 rows in set
```

修改 `rb` 列数据类型为 `TEXT`，示例如下：

```sql
ALTER TABLE t1 MODIFY COLUMN rb TEXT CHARACTER SET utf8mb4 COLLATE utf8mb4_bin;
```

再次查询表，返回结果如下：

```sql
SELECT * FROM t1;
【需要研发确认】
+-----------------+
| rb              |
+-----------------+
|           |
|           |
|                |
|           |
+-----------------+
4 rows in set
```

## 不支持的类型转换

不支持将其他数据类型列转换为高效压缩位图类型，否则会返回如下报错：

```shell
ERROR 1235 (0A000): Modify other type to roaringbitmap not supported
```

【qita】

支持将高效压缩位图数据类型显示为十六进制字符串，示例如下：

```sql
CREATE TABLE t1 (rb ROARINGBITMAP);
INSERT INTO t1 VALUES (rb_from_string('1,2,3'));
SELECT * FROM t1;
```

返回结果如下：

```shell
+----------------------------------+
| rb                               |
+----------------------------------+
| 0x010303010000000200000003000000 |
+----------------------------------+
1 rows in set
```

查询含有元素 `1,2,3` 的高效压缩位图数据时，返回显示的是十六进制数。

支持将十六进制字符串显示为高效压缩位图数据类型，示例如下：

```sql
INSERT INTO t1 VALUES (x'010303010000000200000003000000');
SELECT rb_to_string(rb) FROM t1;
```

返回结果如下：

```shell
+------------------+
| rb_to_string(rb) |
+------------------+
| 1,2,3            |
+------------------+
1 row in set
```