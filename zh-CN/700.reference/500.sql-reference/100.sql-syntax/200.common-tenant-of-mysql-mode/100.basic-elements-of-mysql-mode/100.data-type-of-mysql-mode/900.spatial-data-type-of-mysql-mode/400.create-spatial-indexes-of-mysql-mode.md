| Description   |                 |
|---------------|-----------------|
| keywords      |                 |
| dir-name      |                 |
| dir-name-en   |                 |
| tenant-type   | MySQL Mode      |

# 创建空间索引

OceanBase 数据库支持创建常规索引的语法创建空间索引，但使用 `SPATIAL` 关键字。空间索引中的列必须声明为 `NOT NULL`。

## 准备工作

使用 GIS 功能前，需在业务租户配置 GIS meta 数据。在连接到服务器后，执行如下命令将  `default_srs_data_mysql.sql` 文件导入到数据库中：

```shell
## $password 需替换为登录数据库的密码
## $localhost 需替换为登录数据库的 IP
## $tenant_name 需替换为登录数据库的租户名
## $port 需替换为数据库端口号
$python /home/admin/oceanbase/bin/import_srs_data.py -p'$password' -h $localhost -P $port -t $tenant_name -f /home/admin/oceanbase/etc/default_srs_data_mysql.sql
```

返回以下结果代表导入数据文件成功：

```shell
INFO: succeed to import srs data
INFO: oceanbase.__all_spatial_reference_systems old result rows -- 1
INFO: oceanbase.__all_spatial_reference_systems new result rows -- 5152
```

## 示例

以下示例展示如何创建空间索引：

- 使用 `CREATE TABLE`:

```sql
CREATE TABLE geom (g GEOMETRY NOT NULL SRID 4326, SPATIAL INDEX(g));
```

- 使用 `ALTER TABLE`：

```sql
CREATE TABLE geom (g GEOMETRY NOT NULL SRID 4326);
ALTER TABLE geom ADD SPATIAL INDEX(g);
```

- 使用 `CREATE INDEX`：

```sql
CREATE TABLE geom (g GEOMETRY NOT NULL SRID 4326);
CREATE SPATIAL INDEX g ON geom (g);
```

以下示例展示如何删除空间索引：

- 使用 `ALTER TABLE`：

```sql
ALTER TABLE geom DROP INDEX g;
```

- 使用 `DROP INDEX`：

```sql
DROP INDEX g ON geom;
```

## 约束

* 创建空间索引的列定义中必须包含 `NOT NULL` 约束。
* 在创建了索引之后，比较的时候使用列定义中的 SRID 所对应的坐标系。空间索引存储了几何对象的 MBR（Minimum Bounding Rectangle）构建，MBR 的比较方式也依赖于 SRID。
* 创建了空间索引的列最好是已经定义了 SRID，否则在该列上建的空间索引在查询时无法生效。
