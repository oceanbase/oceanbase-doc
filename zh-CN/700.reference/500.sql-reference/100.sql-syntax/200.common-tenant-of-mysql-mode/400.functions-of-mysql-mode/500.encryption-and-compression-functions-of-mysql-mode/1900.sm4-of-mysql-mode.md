| Description   |                 |
|---------------|-----------------|
| keywords      |                 |
| dir-name      |                 |
| dir-name-en   |                 |
| tenant-type   | MySQL Mode      |

# SM4

## 声明

```javascript
SM4(str)
```

## 说明

SM4 是中国国家密码管理局发布的一种分组加密计算方法，算法公开，分组长度和密钥长度都是 128 位。

SM4 的计算包含两个步骤：

1. 在 Mysql 租户中的使用需要先设置系统变量 `block_encryption_mode`。  
2. 然后调用 `sm4_encrypt` 和 `sm4_decrypt` 两个系统函数进行计算。

<main id="notice" type='notice'>
  <h4>注意</h4>
  <p>社区版暂不支持 `sm4_decrypt` 系统函数。</p>
</main>

## 示例

1. `sm4-ecb` 模式下，`sm4_encrypt` 和 `sm4_decrypt` 接受两个参数 `{明文，密钥}`，如果传入三个值，第三个值将被忽略。例如：

```javascript
SET block_encryption_mode = 18;

SELECT hex(sm4_encrypt('asdasdasdasd', '12312313123'))  FROM dual;
+--------------------------------------------------------------------------------------------------+
| hex(sm4_encrypt('asdasdasdasd', '12312313123')) |
+--------------------------------------------------------------------------------------------------+
| E0640595B963E365A70CB24DC8A3E349                                                                 |
+--------------------------------------------------------------------------------------------------+

SELECT hex(sm4_encrypt('asdasdasdasd', '12312313123', 'asdasdkljasdkljalskdjaklsdjaklsjdaklsdjlaksdj'))  FROM dual;
+--------------------------------------------------------------------------------------------------+
| hex(sm4_encrypt('asdasdasdasd', '12312313123', 'asdasdkljasdkljalskdjaklsdjaklsjdaklsdjlaksdj')) |
+--------------------------------------------------------------------------------------------------+
| E0640595B963E365A70CB24DC8A3E349                                                                 |
+--------------------------------------------------------------------------------------------------+
Warnings:
Warning	9721	input value for iv is not valid
```

2. `sm4-cbc`、`sm4-cfb`、`sm4-ofb` 模式下，`sm4_encryt` 和 `sm4_decrypt` 只接收三个参数。例如：

```javascript
SELECT hex(sm4_encrypt('asdasdasdasd', '12312313123', 'asdasdkljasdkljalskdjaklsdjaklsjdaklsdjlaksdj'))  FROM dual;
+--------------------------------------------------------------------------------------------------+
| hex(sm4_encrypt('asdasdasdasd', '12312313123', 'asdasdkljasdkljalskdjaklsdjaklsjdaklsdjlaksdj')) |
+--------------------------------------------------------------------------------------------------+
| 646B83FDA4E969244E2B9BD835578D50                                                                 |
+-------------------------------------------------------------------------------------
```