|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type||

# GV$OB_PLAN_CACHE_PLAN_EXPLAIN

<main id="notice" type='explain'>
  <h4>说明</h4>
  <p>从 V4.0.0 版本开始引入。</p>
</main>

## 功能描述

视图 `GV$OB_PLAN_CACHE_PLAN_EXPLAIN` 用于展示缓存在全部的 OBServer 节点中的计划缓存中的物理执行计划。

  <main id="notice" type='explain'>
    <h4>说明</h4>
    <p>该视图仅支持 GET 操作，查询时需要指定 IP、PORT、TENANT_ID、PLAN_ID 字段。</p>
  </main>

## 字段说明

|   **字段名称**   |    **类型**     | **是否可以为空** |      **描述**      |
|--------------|---------------|------------|------------------|
| TENANT_ID    | bigint(20)    | NO         | 租户 ID            |
| SVR_IP       | varchar(46)   | NO         | 服务器 IP 地址        |
| SVR_PORT     | bigint(20)    | NO         | 服务器端口号           |
| PLAN_ID      | bigint(20)    | NO         | 计划的 ID           |
| PLAN_DEPTH   | bigint(20)    | NO         | Operator 在展示时的深度 |
| PLAN_LINE_ID | bigint(20)    | NO         | Operator 的编号     |
| OPERATOR     | varchar(128)  | NO         | Operator 的名称     |
| NAME         | varchar(256)  | NO         | 表的名称             |
| ROWS         | bigint(20)    | NO         | 预估的结果行数          |
| COST         | bigint(20)    | NO         | 预估的代价            |
| PROPERTY     | varchar(4096) | NO         | 对应 Operator 的信息  |

## 查询示例

1. 通过 [GV$OB_PLAN_CACHE_PLAN_STAT](2300.gv-ob_plan_cache_plan_stat-of-sys-tenant.md) 视图查询当前 OBServer 节点的 `PLAN_ID`。

    ```shell
    obclient [oceanbase]> SELECT PLAN_ID FROM oceanbase.GV$OB_PLAN_CACHE_PLAN_STAT limit 2;
    ```

    查询结果如下：

    ```shell
    +---------+
    | PLAN_ID |
    +---------+
    |     605 |
    |     607 |
    +---------+
    2 rows in set (0.010 sec)
    ```

2. 以 `PLAN_ID=605` 为例，通过 `GV$OB_PLAN_CACHE_PLAN_EXPLAIN` 视图查询计划缓存中的物理执行计划。

    ```shell
    obclient [oceanbase]> SELECT * FROM oceanbase.GV$OB_PLAN_CACHE_PLAN_EXPLAIN WHERE PLAN_ID = 605\G
    ```

    查询结果如下：

    ```shell
    *************************** 1. row ***************************
      TENANT_ID: 1002
          SVR_IP: xx.xx.xx.xx
        SVR_PORT: 2882
        PLAN_ID: 605
      PLAN_DEPTH: 0
    PLAN_LINE_ID: 0
        OPERATOR: PHY_TABLE_SCAN
            NAME: __all_balance_task
            ROWS: 1
            COST: 2
        PROPERTY: table_rows:1, physical_range_rows:1, logical_range_rows:1, index_back_rows:0, output_rows:1, avaiable_index_name[__all_balance_task]
    1 row in set (0.000 sec)
    ```

## 相关视图或文档

[V$OB_PLAN_CACHE_PLAN_EXPLAIN](32600.v-ob_plan_cache_plan_explain-of-sys-tenant.md)

