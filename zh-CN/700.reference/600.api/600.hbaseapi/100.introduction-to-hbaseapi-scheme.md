# OBKV-HBase 方案介绍

OBKV-HBase 通过 HBase 兼容的 API 和合适的存储模型，使 HBase 业务可以平滑迁移到 OceanBase 数据库。

## 背景信息

OceanBase 的 OBKV-HBase 客户端基于 OBKV-Table 提供的基本接口，在客户端封装了 HBase 兼容的 API 接口（目前已兼容 HBase 0.94 版本的特性）。若您当前有业务使用了原生 HBase 数据操作逻辑，您可以通过安装 OceanBase 数据库集群，在 OBServer 服务端建立 HBase Table，并通过 OBKV-HBase 进行数据操作。

> **说明**
>
> 关于 OBKV-Table 的方案介绍，用户可参考 [OBKV-Table 方案介绍](https://open.oceanbase.com/docs/observer-cn/V3.1.1/10000000000013926)。

欢迎您访问 [OceanBase GitHub 网站](https://github.com/oceanbase) 体验 OBKV 的客户端使用：

+ OBKV-Table 使用请参考：[Simple OBKV-Table Demo](https://github.com/oceanbase/obkv-table-client-java/tree/master/example)

如果您想对 HBase 有更深入的了解，请参考 [Apache HBase 官方网站](https://hbase.apache.org/)、[Apache HBase interface 接口](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Table.html)。

## OBKV-HBase 存储模型

您可以使用宽表模型（WideColumn）对数据建模，以便更好的兼容 HBase 的数据及后续通过 OBKV-HBase 维护。具体操作，请参考 [OBKV-HBase 存储模型](../600.hbaseapi/200.hbaseapi-storage-models.md)。
如果您想了解 HBase 存储模型的详细内容，请参考 [Apache HBase 数据模型](https://hbase.apache.org/book.html#datamodel)。

## OBKV-HBase 客户端

您可以通过 OBKV-HBase 客户端，使用 HBase 兼容的 API 进行数据处理，具体操作，请参考 [OBKV-HBase 客户端使用介绍](../600.hbaseapi/300.use-of-the-hbaseapi-client.md)。

以下是 OBKV-HBase 的相关功能说明：

### 客户端线程池模型

OBKV-HBase 提供 table pool 池化模式管理多个 table 的操作实例，目前资源池包含有 Reusable、RoundRobin 和 ThreadLoca 三种方式。用户可以在实例化 table pool 时指定使用某种模式。

### 路由表预热

支持在集群某台机器宕机时，客户端对指定 HBase table 的路由表信息进行刷新，避免造成服务暂停或服务无法访问。客户端也可以通过不定时预热操作，刷新集群的路由信息。

### 兼容性

OBKV-HBase 客户端实现了 [HTableInterface](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/HTableInterface.html) 的接口，其接口的兼容性如下：

|Modifier and Type|Method and Description|compatibility|
|---|----|----|
|[Result](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/Result.html)|[append](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/HTableInterface.html#append(org.apache.hadoop.hbase.client.Append))([Append](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/Append.html) append）</br>Appends values to one or more columns within a single row.|supported|
|[Object](https://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true)[]|[batch](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/HTableInterface.html#batch(java.util.List)) ([List](https://docs.oracle.com/javase/6/docs/api/java/util/List.html?is-external=true) <? extends [Row](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/Row.html) > actions)Same as [batch(List, Object[])](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/HTableInterface.html#batch(java.util.List,%20java.lang.Object[])), </br>but returns an array of results instead of using a results parameter reference.|not support|
|void|[batch](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/HTableInterface.html#batch(java.util.List,%20java.lang.Object[]))([List](https://docs.oracle.com/javase/6/docs/api/java/util/List.html?is-external=true) <? extends [Row](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/Row.html) > actions, [Object](https://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true)[] results)</br>Method that does a batch call on Deletes, Gets, Puts, Increments, Appends and RowMutations.|not support|
|boolean|[checkAndDelete](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/HTableInterface.html#checkAndDelete(byte[],%20byte[],%20byte[],%20byte[],%20org.apache.hadoop.hbase.client.Delete))(byte[] row, byte[] family, byte[] qualifier, byte[] value,[Delete](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/Delete.html)  delete)</br>Atomically checks if a row/family/qualifier value matches the expected value.|supported|
|boolean|[checkAndPut](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/HTableInterface.html#checkAndPut(byte[],%20byte[],%20byte[],%20byte[],%20org.apache.hadoop.hbase.client.Put))(byte[] row, byte[] family, byte[] qualifier, byte[] value, [Put](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/Put.html) put)</br>Atomically checks if a row/family/qualifier value matches the expected value.|supported|
|void|[close](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/HTableInterface.html#close())()</br>Releases any resources help or pending changes in internal buffers.|supported|
|\<T extends [CoprocessorProtocol](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/ipc/CoprocessorProtocol.html),R>[Map](https://docs.oracle.com/javase/6/docs/api/java/util/Map.html?is-external=true)\<byte[],R>|[coprocessorExec](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/HTableInterface.html#coprocessorExec(java.lang.Class,%20byte[],%20byte[],%20org.apache.hadoop.hbase.client.coprocessor.Batch.Call))([Class](https://docs.oracle.com/javase/6/docs/api/java/lang/Class.html?is-external=true)\<T> protocol, byte[] startKey, byte[] endKey, [Batch.Call](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/coprocessor/Batch.Call.html)\<T,R> callable)</br>Invoke the passed [Batch.Call](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/coprocessor/Batch.Call.html) against the [CoprocessorProtocol](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/ipc/CoprocessorProtocol.html) instances running in the selected regions.|not support|
|\<T extends [CoprocessorProtocol](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/ipc/CoprocessorProtocol.html),R> void|[coprocessorExec](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/HTableInterface.html#coprocessorExec(java.lang.Class,%20byte[],%20byte[],%20org.apache.hadoop.hbase.client.coprocessor.Batch.Call,%20org.apache.hadoop.hbase.client.coprocessor.Batch.Callback))([Class](https://docs.oracle.com/javase/6/docs/api/java/lang/Class.html?is-external=true)\<T> protocol, byte[] startKey, byte[] endKey,[Batch.Call](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/coprocessor/Batch.Call.html)\<T,R> callable,[Batch.Callback](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/coprocessor/Batch.Callback.html)\<R> callback)</br>Invoke the passed [Batch.Call](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/coprocessor/Batch.Call.html) against the [CoprocessorProtocol](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/ipc/CoprocessorProtocol.html) instances running in the selected regions.|not support|
|\<T extends [CoprocessorProtocol](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/ipc/CoprocessorProtocol.html)> T|[coprocessorProxy](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/HTableInterface.html#coprocessorProxy(java.lang.Class,%20byte[]))([Class](https://docs.oracle.com/javase/6/docs/api/java/lang/Class.html?is-external=true)\<T> protocol, byte[] row)</br>Creates and returns a proxy to the CoprocessorProtocol instance running in the region containing the specified row.|not support|
|void|[delete](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/HTableInterface.html#delete(org.apache.hadoop.hbase.client.Delete))([Delete](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/Delete.html) delete)</br>Deletes the specified cells/row.|supported|
|void|[delete](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/HTableInterface.html#delete(java.util.List))([List](https://docs.oracle.com/javase/6/docs/api/java/util/List.html?is-external=true)\<[Delete](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/Delete.html)> deletes)</br>Deletes the specified cells/rows in bulk.|supported|
|boolean|[exists](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/HTableInterface.html#exists(org.apache.hadoop.hbase.client.Get))([Get](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/Get.html) get)</br>Test for the existence of columns in the table, as specified in the Get.|supported|
|void|[flushCommits](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/HTableInterface.html#flushCommits())()</br>Executes all the buffered [Put](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/Put.html) operations.|supported|
|[Result](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/Result.html)|[get](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/HTableInterface.html#get(org.apache.hadoop.hbase.client.Get))([Get](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/Get.html) get)</br>Extracts certain cells from a given row.|supported|
|[Result](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/Result.html)[]|[get](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/HTableInterface.html#get(java.util.List))([List](https://docs.oracle.com/javase/6/docs/api/java/util/List.html?is-external=true)\<[Get](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/Get.html)> gets)</br>Extracts certain cells from the given rows, in batch.|supported|
|org.apache.hadoop.conf.Configuration|[getConfiguration](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/HTableInterface.html#getConfiguration())()</br>Returns the Returns the Configuration object used by this instance.|supported|
|[Result](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/Result.html)|[getRowOrBefore](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/HTableInterface.html#getRowOrBefore(byte[],%20byte[]))(byte[] row, byte[] family)</br>Deprecated. As of version 0.92 this method is deprecated without replacement. getRowOrBefore is used internally to find entries in .META. and makes various assumptions about the table (which are true for .META. but not in general) to be efficient.|Deprecated|
|[ResultScanner](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/ResultScanner.html)|[getScanner](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/HTableInterface.html#getScanner(byte[]))(byte[] family)</br>Gets a scanner on the current table for the given family.|supported|
|[ResultScanner](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/ResultScanner.html)|[getScanner](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/HTableInterface.html#getScanner(byte[],%20byte[]))(byte[] family, byte[] qualifier)</br>Gets a scanner on the current table for the given family and qualifier.|supported|
|[ResultScanner](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/ResultScanner.html)|[getScanner](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/HTableInterface.html#getScanner(org.apache.hadoop.hbase.client.Scan))([Scan](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/Scan.html) scan)</br>Returns a scanner on the current table as specified by the [Scan](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/Scan.html) object.|supported|
|[HTableDescriptor](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/HTableDescriptor.html)|[getTableDescriptor](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/HTableInterface.html#getTableDescriptor())()</br>Gets the [table descriptor](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/HTableDescriptor.html) for this table.|not support|
|byte[]|[getTableName](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/HTableInterface.html#getTableName())()</br>Gets the name of this table.|supported|
|long|[getWriteBufferSize](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/HTableInterface.html#getWriteBufferSize())()</br>Returns the maximum size in bytes of the write buffer for this HTable.|supported|
|[Result](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/Result.html)|[increment](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/HTableInterface.html#increment(org.apache.hadoop.hbase.client.Increment))([Increment](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/Increment.html)  increment)</br>Increments one or more columns within a single row.|supported|
|long|[incrementColumnValue](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/HTableInterface.html#incrementColumnValue(byte[],%20byte[],%20byte[],%20long))(byte[] row, byte[] family, byte[] qualifier, long amount)</br>Atomically increments a column value.|supported|
|long|[incrementColumnValue](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/HTableInterface.html#incrementColumnValue(byte[],%20byte[],%20byte[],%20long,%20boolean))(byte[] row, byte[] family, byte[] qualifier, long amount, Durability durability)</br>Atomically increments a column value.|supported|
|boolean|[isAutoFlush](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/HTableInterface.html#isAutoFlush())()</br>Tells whether or not 'auto-flush' is turned on.|supported|
|[RowLock](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/RowLock.html)|[lockRow](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/HTableInterface.html#lockRow(byte[]))(byte[] row)</br>Deprecated.[RowLock](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/RowLock.html) and associated operations are deprecated|Deprecated|
|void|[mutateRow](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/HTableInterface.html#mutateRow(org.apache.hadoop.hbase.client.RowMutations))([RowMutations](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/RowMutations.html)  rm)</br>Performs multiple mutations atomically on a single row.|not support|
|void|[put](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/HTableInterface.html#put(java.util.List))([List](https://docs.oracle.com/javase/6/docs/api/java/util/List.html?is-external=true)\<[Put](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/Put.html)> puts)</br>Puts some data in the table, in batch.|supported|
|void|[put](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/HTableInterface.html#put(org.apache.hadoop.hbase.client.Put))([Put](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/Put.html)  put)</br>Puts some data in the table.|supported|
|void|[setAutoFlush](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/HTableInterface.html#setAutoFlush(boolean))(boolean autoFlush)</br>See [setAutoFlush(boolean, boolean)](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/HTableInterface.html#setAutoFlush(boolean,%20boolean))|supported|
|void|[setAutoFlush](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/HTableInterface.html#setAutoFlush(boolean,%20boolean))(boolean autoFlush, boolean clearBufferOnFail)</br>Turns 'auto-flush' on or off.|supported|
|void|[setWriteBufferSize](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/HTableInterface.html#setWriteBufferSize(long))(long writeBufferSize)</br>Sets the size of the buffer in bytes.|supported|
|void|[unlockRow](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/HTableInterface.html#unlockRow(org.apache.hadoop.hbase.client.RowLock))([RowLock](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/RowLock.html)  rl)</br>Deprecated.[RowLock](https://svn.apache.org/repos/asf/hbase/hbase.apache.org/trunk/0.94/apidocs/org/apache/hadoop/hbase/client/RowLock.html) and associated operations are deprecated|Deprecated|
