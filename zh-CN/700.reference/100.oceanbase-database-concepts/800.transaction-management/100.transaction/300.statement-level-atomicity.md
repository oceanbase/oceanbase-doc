|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type||

# 语句级原子性

OceanBase 数据库支持语句级的原子性，语句级的原子性指的是一条语句的操作要么都成功要么都失败，不会存在部分成功部分失败的情况。

当一条语句执行过程中没有报错，那么该语句所做的修改都是成功的，如果一条语句执行过程中报错，那么该语句执行的操作都会被回滚，这种情况称为语句级回滚。语句级回滚有如下特点：

* 语句回滚时仅回滚本语句的修改，不会影响当前事务该语句之前语句所做的修改。

  例如，一个事务有 2 条 `UPDATE` 语句，第一条 `UPDATE` 语句执行成功，第二条 `UPDATE` 语句执行失败，则只有第二条 `UPDATE` 语句会发生语句级回滚，第一条 `UPDATE` 语句所做的修改会被保留。
  
* 语句级回滚的效果等价于语句没有被执行过，即语句执行过程中涉及的全局索引、触发器、行锁等均属于语句的操作，语句回滚需要将这些操作都回滚到语句开启之前的状态。

常见的语句级回滚主要有：

* Insert 操作出现主键冲突会导致语句级回滚。

* 单条语句执行时间过长，语句执行超时可能出现语句级回滚。

* 多个事务存在行锁冲突导致死锁，某个事务被死锁检测机制 Kill 掉可能会出现语句级回滚。

SQL 语句的语法解析报错不涉及到语句级回滚，因为语句解析报错尚未对数据进行修改。
