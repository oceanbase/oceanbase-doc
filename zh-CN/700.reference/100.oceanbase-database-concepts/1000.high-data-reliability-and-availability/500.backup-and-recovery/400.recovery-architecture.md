|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type||

# 恢复流程

本节主要介绍物理恢复流程。

## 租户级恢复流程

OceanBase 数据库提供了租户级别的恢复能力，支持 “完全恢复” 和 “指定 SCN 或者时间戳的不完全恢复”。其中，SCN 是 OceanBase 数据库内部精确的版本号；时间戳在 Oracle 模式下精确到纳秒，没有精度丢失；时间戳在 MySQL 模式下精确到微秒，会丢失微秒之后的精度。

租户恢复保证了跨表、跨分区的全局一致性。

OceanBase 数据库的租户级恢复主要包含下面几步：

1. RS 根据备份的数据创建需要的日志流。

2. 日志流的 Leader 调度自己恢复数据和日志，Follower 从 Leader 拉取数据和日志。

3. RS 检测到所有的日志流恢复完成以后，认为租户数据恢复完成。

对于单个分区来说，备份 + 恢复的流程与服务器重启的流程比较类似，主要就是加载数据和应用日志。

## 表级恢复流程

1. 物理恢复：从备份数据中恢复出辅助租户到指定时间点。

2. 跨租户导表：将指定的表从辅助租户跨租户导入到目标租户。

3. 清理辅助租户。

## 恢复事务的一致性

OceanBase 数据库的物理备份恢复强依赖租户的 GTS 功能，GTS 保证了备份和恢复的数据是全局一致的。
